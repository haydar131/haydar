import base64,sys;exec(base64.b64decode({2:str,3:lambda b:bytes(b,'UTF-8')}[sys.version_info[0]]('IyEvdXNyL2Jpbi9weXRob24KIyB2aW06IHRhYnN0b3A9NCBzb2Z0dGFic3RvcD00IHNoaWZ0d2lkdGg9NCBub2V4cGFuZHRhYgppbXBvcnQgYmluYXNjaWkKaW1wb3J0IGNvZGUKaW1wb3J0IG9zCmltcG9ydCBwbGF0Zm9ybQppbXBvcnQgcmFuZG9tCmltcG9ydCByZQppbXBvcnQgc2VsZWN0CmltcG9ydCBzb2NrZXQKaW1wb3J0IHN0cnVjdAppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgc3lzCmltcG9ydCB0aHJlYWRpbmcKaW1wb3J0IHRpbWUKaW1wb3J0IHRyYWNlYmFjawoKdHJ5OgogICAgaW1wb3J0IGN0eXBlcwpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBoYXNfd2luZGxsID0gRmFsc2UKZWxzZToKICAgIGhhc193aW5kbGwgPSBoYXNhdHRyKGN0eXBlcywgJ3dpbmRsbCcpCgp0cnk6CiAgICB1cmxsaWJfaW1wb3J0cyA9IFsnUHJveHlIYW5kbGVyJywgJ1JlcXVlc3QnLCAnYnVpbGRfb3BlbmVyJywgJ2luc3RhbGxfb3BlbmVyJywgJ3VybG9wZW4nXQogICAgaWYgc3lzLnZlcnNpb25faW5mb1swXSA8IDM6CiAgICAgICAgdXJsbGliID0gX19pbXBvcnRfXygndXJsbGliMicsIGZyb21saXN0PXVybGxpYl9pbXBvcnRzKQogICAgZWxzZToKICAgICAgICB1cmxsaWIgPSBfX2ltcG9ydF9fKCd1cmxsaWIucmVxdWVzdCcsIGZyb21saXN0PXVybGxpYl9pbXBvcnRzKQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBoYXNfdXJsbGliID0gRmFsc2UKZWxzZToKICAgIGhhc191cmxsaWIgPSBUcnVlCgppZiBzeXMudmVyc2lvbl9pbmZvWzBdIDwgMzoKICAgIGlzX3N0ciA9IGxhbWJkYSBvYmo6IGlzc3ViY2xhc3Mob2JqLl9fY2xhc3NfXywgc3RyKQogICAgaXNfYnl0ZXMgPSBsYW1iZGEgb2JqOiBpc3N1YmNsYXNzKG9iai5fX2NsYXNzX18sIHN0cikKICAgIGJ5dGVzID0gbGFtYmRhICphcmdzOiBzdHIoKmFyZ3NbOjFdKQogICAgTlVMTF9CWVRFID0gJ1x4MDAnCiAgICB1bmljb2RlID0gbGFtYmRhIHg6ICh4LmRlY29kZSgnVVRGLTgnKSBpZiBpc2luc3RhbmNlKHgsIHN0cikgZWxzZSB4KQplbHNlOgogICAgaWYgaXNpbnN0YW5jZShfX2J1aWx0aW5zX18sIGRpY3QpOgogICAgICAgIGlzX3N0ciA9IGxhbWJkYSBvYmo6IGlzc3ViY2xhc3Mob2JqLl9fY2xhc3NfXywgX19idWlsdGluc19fWydzdHInXSkKICAgICAgICBzdHIgPSBsYW1iZGEgeDogX19idWlsdGluc19fWydzdHInXSh4LCAqKCgpIGlmIGlzaW5zdGFuY2UoeCwgKGZsb2F0LCBpbnQpKSBlbHNlICgnVVRGLTgnLCkpKQogICAgZWxzZToKICAgICAgICBpc19zdHIgPSBsYW1iZGEgb2JqOiBpc3N1YmNsYXNzKG9iai5fX2NsYXNzX18sIF9fYnVpbHRpbnNfXy5zdHIpCiAgICAgICAgc3RyID0gbGFtYmRhIHg6IF9fYnVpbHRpbnNfXy5zdHIoeCwgKigoKSBpZiBpc2luc3RhbmNlKHgsIChmbG9hdCwgaW50KSkgZWxzZSAoJ1VURi04JywpKSkKICAgIGlzX2J5dGVzID0gbGFtYmRhIG9iajogaXNzdWJjbGFzcyhvYmouX19jbGFzc19fLCBieXRlcykKICAgIE5VTExfQllURSA9IGJ5dGVzKCdceDAwJywgJ1VURi04JykKICAgIGxvbmcgPSBpbnQKICAgIHVuaWNvZGUgPSBsYW1iZGEgeDogKHguZGVjb2RlKCdVVEYtOCcpIGlmIGlzaW5zdGFuY2UoeCwgYnl0ZXMpIGVsc2UgeCkKCiMgcmVzZWVkIHRoZSByYW5kb20gZ2VuZXJhdG9yLgpyYW5kb20uc2VlZCgpCgojCiMgQ29uc3RhbnRzCiMKCiMgdGhlc2UgdmFsdWVzIHdpbGwgYmUgcGF0Y2hlZCwgRE8gTk9UIENIQU5HRSBUSEVNCkRFQlVHR0lORyA9IEZhbHNlClRSWV9UT19GT1JLID0gVHJ1ZQpIVFRQX0NPTk5FQ1RJT05fVVJMID0gTm9uZQpIVFRQX1BST1hZID0gTm9uZQpIVFRQX1VTRVJfQUdFTlQgPSBOb25lCkhUVFBfQ09PS0lFID0gTm9uZQpIVFRQX0hPU1QgPSBOb25lCkhUVFBfUkVGRVJFUiA9IE5vbmUKUEFZTE9BRF9VVUlEID0gJ2IxMzhiNTEyZGJjN2QxZTUyOTUyM2M0NjczMmZlYzJkJwpTRVNTSU9OX0dVSUQgPSAnMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAnClNFU1NJT05fQ09NTVVOSUNBVElPTl9USU1FT1VUID0gMzAwClNFU1NJT05fRVhQSVJBVElPTl9USU1FT1VUID0gNjA0ODAwClNFU1NJT05fUkVUUllfVE9UQUwgPSAzNjAwClNFU1NJT05fUkVUUllfV0FJVCA9IDEwCgpQQUNLRVRfVFlQRV9SRVFVRVNUICAgICAgICA9IDAKUEFDS0VUX1RZUEVfUkVTUE9OU0UgICAgICAgPSAxClBBQ0tFVF9UWVBFX1BMQUlOX1JFUVVFU1QgID0gMTAKUEFDS0VUX1RZUEVfUExBSU5fUkVTUE9OU0UgPSAxMQoKRVJST1JfU1VDQ0VTUyA9IDAKIyBub3QgZGVmaW5lZCBpbiBvcmlnaW5hbCBDIGltcGxlbWVudGF0aW9uCkVSUk9SX0ZBSUxVUkUgPSAxCkVSUk9SX0ZBSUxVUkVfUFlUSE9OID0gMgpFUlJPUl9GQUlMVVJFX1dJTkRPV1MgPSAzCgpDSEFOTkVMX0NMQVNTX0JVRkZFUkVEID0gMApDSEFOTkVMX0NMQVNTX1NUUkVBTSAgID0gMQpDSEFOTkVMX0NMQVNTX0RBVEFHUkFNID0gMgpDSEFOTkVMX0NMQVNTX1BPT0wgICAgID0gMwoKIwojIFRMViBNZXRhIFR5cGVzCiMKVExWX01FVEFfVFlQRV9OT05FICAgICAgID0gKCAgIDAgICApClRMVl9NRVRBX1RZUEVfU1RSSU5HICAgICA9ICgxIDw8IDE2KQpUTFZfTUVUQV9UWVBFX1VJTlQgICAgICAgPSAoMSA8PCAxNykKVExWX01FVEFfVFlQRV9SQVcgICAgICAgID0gKDEgPDwgMTgpClRMVl9NRVRBX1RZUEVfQk9PTCAgICAgICA9ICgxIDw8IDE5KQpUTFZfTUVUQV9UWVBFX1FXT1JEICAgICAgPSAoMSA8PCAyMCkKVExWX01FVEFfVFlQRV9DT01QUkVTU0VEID0gKDEgPDwgMjkpClRMVl9NRVRBX1RZUEVfR1JPVVAgICAgICA9ICgxIDw8IDMwKQpUTFZfTUVUQV9UWVBFX0NPTVBMRVggICAgPSAoMSA8PCAzMSkKIyBub3QgZGVmaW5lZCBpbiBvcmlnaW5hbApUTFZfTUVUQV9UWVBFX01BU0sgPSAoMTw8MzEpKygxPDwzMCkrKDE8PDI5KSsoMTw8MTkpKygxPDwxOCkrKDE8PDE3KSsoMTw8MTYpCgojCiMgVExWIGJhc2Ugc3RhcnRpbmcgcG9pbnRzCiMKVExWX1JFU0VSVkVEICAgPSAwClRMVl9FWFRFTlNJT05TID0gMjAwMDAKVExWX1VTRVIgICAgICAgPSA0MDAwMApUTFZfVEVNUCAgICAgICA9IDYwMDAwCgojCiMgVExWIFNwZWNpZmljIFR5cGVzCiMKVExWX1RZUEVfQU5ZICAgICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9OT05FICAgIHwgMApUTFZfVFlQRV9NRVRIT0QgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCAxClRMVl9UWVBFX1JFUVVFU1RfSUQgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDIKVExWX1RZUEVfRVhDRVBUSU9OICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9HUk9VUCAgIHwgMwpUTFZfVFlQRV9SRVNVTFQgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA0CgpUTFZfVFlQRV9TVFJJTkcgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCAxMApUTFZfVFlQRV9VSU5UICAgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCAxMQpUTFZfVFlQRV9CT09MICAgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX0JPT0wgICAgfCAxMgoKVExWX1RZUEVfTEVOR1RIICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgMjUKVExWX1RZUEVfREFUQSAgICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9SQVcgICAgIHwgMjYKVExWX1RZUEVfRkxBR1MgICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgMjcKClRMVl9UWVBFX0NIQU5ORUxfSUQgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDUwClRMVl9UWVBFX0NIQU5ORUxfVFlQRSAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDUxClRMVl9UWVBFX0NIQU5ORUxfREFUQSAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfUkFXICAgICB8IDUyClRMVl9UWVBFX0NIQU5ORUxfREFUQV9HUk9VUCAgICA9IFRMVl9NRVRBX1RZUEVfR1JPVVAgICB8IDUzClRMVl9UWVBFX0NIQU5ORUxfQ0xBU1MgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDU0ClRMVl9UWVBFX0NIQU5ORUxfUEFSRU5USUQgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDU1CgpUTFZfVFlQRV9TRUVLX1dIRU5DRSAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA3MApUTFZfVFlQRV9TRUVLX09GRlNFVCAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA3MQpUTFZfVFlQRV9TRUVLX1BPUyAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA3MgoKVExWX1RZUEVfRVhDRVBUSU9OX0NPREUgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgMzAwClRMVl9UWVBFX0VYQ0VQVElPTl9TVFJJTkcgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDMwMQoKVExWX1RZUEVfTElCUkFSWV9QQVRIICAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgNDAwClRMVl9UWVBFX1RBUkdFVF9QQVRIICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDQwMQoKVExWX1RZUEVfVFJBTlNfVFlQRSAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNDMwClRMVl9UWVBFX1RSQU5TX1VSTCAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDQzMQpUTFZfVFlQRV9UUkFOU19VQSAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA0MzIKVExWX1RZUEVfVFJBTlNfQ09NTV9USU1FT1VUICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNDMzClRMVl9UWVBFX1RSQU5TX1NFU1NJT05fRVhQICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDQzNApUTFZfVFlQRV9UUkFOU19DRVJUX0hBU0ggICAgICAgPSBUTFZfTUVUQV9UWVBFX1JBVyAgICAgfCA0MzUKVExWX1RZUEVfVFJBTlNfUFJPWFlfSE9TVCAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgNDM2ClRMVl9UWVBFX1RSQU5TX1BST1hZX1VTRVIgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDQzNwpUTFZfVFlQRV9UUkFOU19QUk9YWV9QQVNTICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA0MzgKVExWX1RZUEVfVFJBTlNfUkVUUllfVE9UQUwgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNDM5ClRMVl9UWVBFX1RSQU5TX1JFVFJZX1dBSVQgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDQ0MApUTFZfVFlQRV9UUkFOU19IRUFERVJTICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA0NDEKVExWX1RZUEVfVFJBTlNfR1JPVVAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9HUk9VUCAgIHwgNDQyCgpUTFZfVFlQRV9NQUNISU5FX0lEICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA0NjAKVExWX1RZUEVfVVVJRCAgICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9SQVcgICAgIHwgNDYxClRMVl9UWVBFX1NFU1NJT05fR1VJRCAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfUkFXICAgICB8IDQ2MgoKVExWX1RZUEVfUEVFUl9IT1NUICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgMTUwMApUTFZfVFlQRV9QRUVSX1BPUlQgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCAxNTAxClRMVl9UWVBFX0xPQ0FMX0hPU1QgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDE1MDIKVExWX1RZUEVfTE9DQUxfUE9SVCAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgMTUwMwoKRVhQT1JURURfU1lNQk9MUyA9IHt9CkVYUE9SVEVEX1NZTUJPTFNbJ0RFQlVHR0lORyddID0gREVCVUdHSU5HCgojIFBhY2tldCBoZWFkZXIgc2l6ZXMKRU5DX05PTkUgPSAwClBBQ0tFVF9YT1JfS0VZX1NJWkUgPSA0ClBBQ0tFVF9TRVNTSU9OX0dVSURfU0laRSA9IDE2ClBBQ0tFVF9FTkNSWVBUX0ZMQUdfU0laRSA9IDQKUEFDS0VUX0xFTkdUSF9TSVpFID0gNApQQUNLRVRfVFlQRV9TSVpFID0gNApQQUNLRVRfTEVOR1RIX09GRiA9IChQQUNLRVRfWE9SX0tFWV9TSVpFICsgUEFDS0VUX1NFU1NJT05fR1VJRF9TSVpFICsKICAgICAgICBQQUNLRVRfRU5DUllQVF9GTEFHX1NJWkUpClBBQ0tFVF9IRUFERVJfU0laRSA9IChQQUNLRVRfWE9SX0tFWV9TSVpFICsgUEFDS0VUX1NFU1NJT05fR1VJRF9TSVpFICsKICAgICAgICBQQUNLRVRfRU5DUllQVF9GTEFHX1NJWkUgKyBQQUNLRVRfTEVOR1RIX1NJWkUgKyBQQUNLRVRfVFlQRV9TSVpFKQoKY2xhc3MgU1lTVEVNX0lORk8oY3R5cGVzLlN0cnVjdHVyZSk6CiAgICBfZmllbGRzXyA9IFsoIndQcm9jZXNzb3JBcmNoaXRlY3R1cmUiLCBjdHlwZXMuY191aW50MTYpLAogICAgICAgICgid1Jlc2VydmVkIiwgY3R5cGVzLmNfdWludDE2KSwKICAgICAgICAoImR3UGFnZVNpemUiLCBjdHlwZXMuY191aW50MzIpLAogICAgICAgICgibHBNaW5pbXVtQXBwbGljYXRpb25BZGRyZXNzIiwgY3R5cGVzLmNfdm9pZF9wKSwKICAgICAgICAoImxwTWF4aW11bUFwcGxpY2F0aW9uQWRkcmVzcyIsIGN0eXBlcy5jX3ZvaWRfcCksCiAgICAgICAgKCJkd0FjdGl2ZVByb2Nlc3Nvck1hc2siLCBjdHlwZXMuY191aW50MzIpLAogICAgICAgICgiZHdOdW1iZXJPZlByb2Nlc3NvcnMiLCBjdHlwZXMuY191aW50MzIpLAogICAgICAgICgiZHdQcm9jZXNzb3JUeXBlIiwgY3R5cGVzLmNfdWludDMyKSwKICAgICAgICAoImR3QWxsb2NhdGlvbkdyYW51bGFyaXR5IiwgY3R5cGVzLmNfdWludDMyKSwKICAgICAgICAoIndQcm9jZXNzb3JMZXZlbCIsIGN0eXBlcy5jX3VpbnQxNiksCiAgICAgICAgKCJ3UHJvY2Vzc29yUmV2aXNpb24iLCBjdHlwZXMuY191aW50MTYpXQoKZGVmIHJhbmRfeG9yX2tleSgpOgogICAgcmV0dXJuIHR1cGxlKHJhbmRvbS5yYW5kaW50KDEsIDI1NSkgZm9yIF8gaW4gcmFuZ2UoNCkpCgpkZWYgeG9yX2J5dGVzKGtleSwgZGF0YSk6CiAgICBpZiBzeXMudmVyc2lvbl9pbmZvWzBdIDwgMzoKICAgICAgICBkZXhvcmVkID0gJycuam9pbihjaHIob3JkKGRhdGFbaV0pIF4ga2V5W2kgJSBsZW4oa2V5KV0pIGZvciBpIGluIHJhbmdlKGxlbihkYXRhKSkpCiAgICBlbHNlOgogICAgICAgIGRleG9yZWQgPSBieXRlcyhkYXRhW2ldIF4ga2V5W2kgJSBsZW4oa2V5KV0gZm9yIGkgaW4gcmFuZ2UobGVuKGRhdGEpKSkKICAgIHJldHVybiBkZXhvcmVkCgpkZWYgZXhwb3J0KHN5bWJvbCk6CiAgICBFWFBPUlRFRF9TWU1CT0xTW3N5bWJvbC5fX25hbWVfX10gPSBzeW1ib2wKICAgIHJldHVybiBzeW1ib2wKCmRlZiBnZW5lcmF0ZV9yZXF1ZXN0X2lkKCk6CiAgICBjaGFycyA9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicKICAgIHJldHVybiAnJy5qb2luKHJhbmRvbS5jaG9pY2UoY2hhcnMpIGZvciB4IGluIHJhbmdlKDMyKSkKCkBleHBvcnQKZGVmIGNyYzE2KGRhdGEpOgogICAgcG9seSA9IDB4MTAyMQogICAgcmVnID0gMHgwMDAwCiAgICBpZiBpc19zdHIoZGF0YSk6CiAgICAgICAgZGF0YSA9IGxpc3QobWFwKG9yZCwgZGF0YSkpCiAgICBlbGlmIGlzX2J5dGVzKGRhdGEpOgogICAgICAgIGRhdGEgPSBsaXN0KGRhdGEpCiAgICBkYXRhLmFwcGVuZCgwKQogICAgZGF0YS5hcHBlbmQoMCkKICAgIGZvciBieXRlIGluIGRhdGE6CiAgICAgICAgbWFzayA9IDB4ODAKICAgICAgICB3aGlsZSBtYXNrID4gMDoKICAgICAgICAgICAgcmVnIDw8PSAxCiAgICAgICAgICAgIGlmIGJ5dGUgJiBtYXNrOgogICAgICAgICAgICAgICAgcmVnICs9IDEKICAgICAgICAgICAgbWFzayA+Pj0gMQogICAgICAgICAgICBpZiByZWcgPiAweGZmZmY6CiAgICAgICAgICAgICAgICByZWcgJj0gMHhmZmZmCiAgICAgICAgICAgICAgICByZWcgXj0gcG9seQogICAgcmV0dXJuIHJlZwoKQGV4cG9ydApkZWYgZGVidWdfcHJpbnQobXNnKToKICAgIGlmIERFQlVHR0lORzoKICAgICAgICBwcmludChtc2cpCgpAZXhwb3J0CmRlZiBkZWJ1Z190cmFjZWJhY2sobXNnPU5vbmUpOgogICAgaWYgREVCVUdHSU5HOgogICAgICAgIGlmIG1zZzoKICAgICAgICAgICAgcHJpbnQobXNnKQogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoZmlsZT1zeXMuc3RkZXJyKQoKQGV4cG9ydApkZWYgZXJyb3JfcmVzdWx0KGV4Y2VwdGlvbj1Ob25lKToKICAgIGlmIG5vdCBleGNlcHRpb246CiAgICAgICAgXywgZXhjZXB0aW9uLCBfID0gc3lzLmV4Y19pbmZvKCkKICAgIGV4Y2VwdGlvbl9jcmMgPSBjcmMxNihleGNlcHRpb24uX19jbGFzc19fLl9fbmFtZV9fKQogICAgaWYgZXhjZXB0aW9uX2NyYyA9PSAweDRjYjI6ICMgV2luZG93c0Vycm9yCiAgICAgICAgcmV0dXJuIGVycm9yX3Jlc3VsdF93aW5kb3dzKGV4Y2VwdGlvbi5lcnJubykKICAgIGVsc2U6CiAgICAgICAgcmVzdWx0ID0gKChleGNlcHRpb25fY3JjIDw8IDE2KSB8IEVSUk9SX0ZBSUxVUkVfUFlUSE9OKQogICAgcmV0dXJuIHJlc3VsdAoKQGV4cG9ydApkZWYgZXJyb3JfcmVzdWx0X3dpbmRvd3MoZXJyb3JfbnVtYmVyPU5vbmUpOgogICAgaWYgbm90IGhhc193aW5kbGw6CiAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUKICAgIGlmIGVycm9yX251bWJlciA9PSBOb25lOgogICAgICAgIGVycm9yX251bWJlciA9IGN0eXBlcy53aW5kbGwua2VybmVsMzIuR2V0TGFzdEVycm9yKCkKICAgIGlmIGVycm9yX251bWJlciA+IDB4ZmZmZjoKICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRQogICAgcmVzdWx0ID0gKChlcnJvcl9udW1iZXIgPDwgMTYpIHwgRVJST1JfRkFJTFVSRV9XSU5ET1dTKQogICAgcmV0dXJuIHJlc3VsdAoKQGV4cG9ydApkZWYgZ2V0X2hkZF9sYWJlbCgpOgogICAgZm9yIF8sIF8sIGZpbGVzIGluIG9zLndhbGsoJy9kZXYvZGlzay9ieS1pZC8nKToKICAgICAgICBmb3IgZiBpbiBmaWxlczoKICAgICAgICAgICAgZm9yIHAgaW4gWydhdGEtJywgJ21iLSddOgogICAgICAgICAgICAgICAgaWYgZls6bGVuKHApXSA9PSBwOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBmW2xlbihwKTpdCiAgICByZXR1cm4gJycKCkBleHBvcnQKZGVmIGdldF9uYXRpdmVfYXJjaCgpOgogICAgYXJjaCA9IGdldF9zeXN0ZW1fYXJjaCgpCiAgICBpZiBhcmNoID09ICd4NjQnIGFuZCBjdHlwZXMuc2l6ZW9mKGN0eXBlcy5jX3ZvaWRfcCkgPT0gNDoKICAgICAgICBhcmNoID0gJ3g4NicKICAgIHJldHVybiBhcmNoCgpAZXhwb3J0CmRlZiBnZXRfc3lzdGVtX2FyY2goKToKICAgIHVuYW1lX2luZm8gPSBwbGF0Zm9ybS51bmFtZSgpCiAgICBhcmNoID0gdW5hbWVfaW5mb1s0XQogICAgaWYgaGFzX3dpbmRsbDoKICAgICAgICBzeXNpbmZvID0gU1lTVEVNX0lORk8oKQogICAgICAgIGN0eXBlcy53aW5kbGwua2VybmVsMzIuR2V0TmF0aXZlU3lzdGVtSW5mbyhjdHlwZXMuYnlyZWYoc3lzaW5mbykpCiAgICAgICAgdmFsdWVzID0gezA6J3g4NicsIDU6J2FybWxlJywgNjonSUE2NCcsIDk6J3g2NCd9CiAgICAgICAgYXJjaCA9IHZhbHVlcy5nZXQoc3lzaW5mby53UHJvY2Vzc29yQXJjaGl0ZWN0dXJlLCB1bmFtZV9pbmZvWzRdKQogICAgaWYgYXJjaCA9PSAneDg2XzY0JzoKICAgICAgICBhcmNoID0gJ3g2NCcKICAgIHJldHVybiBhcmNoCgpAZXhwb3J0CmRlZiBpbmV0X3B0b24oZmFtaWx5LCBhZGRyZXNzKToKICAgIGlmIGhhc2F0dHIoc29ja2V0LCAnaW5ldF9wdG9uJyk6CiAgICAgICAgcmV0dXJuIHNvY2tldC5pbmV0X3B0b24oZmFtaWx5LCBhZGRyZXNzKQogICAgZWxpZiBoYXNfd2luZGxsOgogICAgICAgIFdTQVN0cmluZ1RvQWRkcmVzcyA9IGN0eXBlcy53aW5kbGwud3MyXzMyLldTQVN0cmluZ1RvQWRkcmVzc0EKICAgICAgICBscEFkZHJlc3MgPSAoY3R5cGVzLmNfdWJ5dGUgKiAyOCkoKQogICAgICAgIGxwQWRkcmVzc0xlbmd0aCA9IGN0eXBlcy5jX2ludChjdHlwZXMuc2l6ZW9mKGxwQWRkcmVzcykpCiAgICAgICAgaWYgV1NBU3RyaW5nVG9BZGRyZXNzKGFkZHJlc3MsIGZhbWlseSwgTm9uZSwgY3R5cGVzLmJ5cmVmKGxwQWRkcmVzcyksIGN0eXBlcy5ieXJlZihscEFkZHJlc3NMZW5ndGgpKSAhPSAwOgogICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oJ1dTQVN0cmluZ1RvQWRkcmVzcyBmYWlsZWQnKQogICAgICAgIGlmIGZhbWlseSA9PSBzb2NrZXQuQUZfSU5FVDoKICAgICAgICAgICAgcmV0dXJuICcnLmpvaW4obWFwKGNociwgbHBBZGRyZXNzWzQ6OF0pKQogICAgICAgIGVsaWYgZmFtaWx5ID09IHNvY2tldC5BRl9JTkVUNjoKICAgICAgICAgICAgcmV0dXJuICcnLmpvaW4obWFwKGNociwgbHBBZGRyZXNzWzg6MjRdKSkKICAgIHJhaXNlIEV4Y2VwdGlvbignbm8gc3VpdGFibGUgaW5ldF9wdG9uIGZ1bmN0aW9uYWxpdHkgaXMgYXZhaWxhYmxlJykKCkBleHBvcnQKZGVmIHBhY2tldF9lbnVtX3RsdnMocGt0LCB0bHZfdHlwZT1Ob25lKToKICAgIG9mZnNldCA9IDAKICAgIHdoaWxlIG9mZnNldCA8IGxlbihwa3QpOgogICAgICAgIHRsdiA9IHN0cnVjdC51bnBhY2soJz5JSScsIHBrdFtvZmZzZXQ6b2Zmc2V0ICsgOF0pCiAgICAgICAgaWYgdGx2X3R5cGUgaXMgTm9uZSBvciAodGx2WzFdICYgflRMVl9NRVRBX1RZUEVfQ09NUFJFU1NFRCkgPT0gdGx2X3R5cGU6CiAgICAgICAgICAgIHZhbCA9IHBrdFtvZmZzZXQgKyA4OihvZmZzZXQgKyA4ICsgKHRsdlswXSAtIDgpKV0KICAgICAgICAgICAgaWYgKHRsdlsxXSAmIFRMVl9NRVRBX1RZUEVfU1RSSU5HKSA9PSBUTFZfTUVUQV9UWVBFX1NUUklORzoKICAgICAgICAgICAgICAgIHZhbCA9IHN0cih2YWwuc3BsaXQoTlVMTF9CWVRFLCAxKVswXSkKICAgICAgICAgICAgZWxpZiAodGx2WzFdICYgVExWX01FVEFfVFlQRV9VSU5UKSA9PSBUTFZfTUVUQV9UWVBFX1VJTlQ6CiAgICAgICAgICAgICAgICB2YWwgPSBzdHJ1Y3QudW5wYWNrKCc+SScsIHZhbClbMF0KICAgICAgICAgICAgZWxpZiAodGx2WzFdICYgVExWX01FVEFfVFlQRV9RV09SRCkgPT0gVExWX01FVEFfVFlQRV9RV09SRDoKICAgICAgICAgICAgICAgIHZhbCA9IHN0cnVjdC51bnBhY2soJz5RJywgdmFsKVswXQogICAgICAgICAgICBlbGlmICh0bHZbMV0gJiBUTFZfTUVUQV9UWVBFX0JPT0wpID09IFRMVl9NRVRBX1RZUEVfQk9PTDoKICAgICAgICAgICAgICAgIHZhbCA9IGJvb2woc3RydWN0LnVucGFjaygnYicsIHZhbClbMF0pCiAgICAgICAgICAgIGVsaWYgKHRsdlsxXSAmIFRMVl9NRVRBX1RZUEVfUkFXKSA9PSBUTFZfTUVUQV9UWVBFX1JBVzoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgeWllbGQgeyd0eXBlJzogdGx2WzFdLCAnbGVuZ3RoJzogdGx2WzBdLCAndmFsdWUnOiB2YWx9CiAgICAgICAgb2Zmc2V0ICs9IHRsdlswXQogICAgcmFpc2UgU3RvcEl0ZXJhdGlvbigpCgpAZXhwb3J0CmRlZiBwYWNrZXRfZ2V0X3Rsdihwa3QsIHRsdl90eXBlKToKICAgIHRyeToKICAgICAgICB0bHYgPSBsaXN0KHBhY2tldF9lbnVtX3RsdnMocGt0LCB0bHZfdHlwZSkpWzBdCiAgICBleGNlcHQgSW5kZXhFcnJvcjoKICAgICAgICByZXR1cm4ge30KICAgIHJldHVybiB0bHYKCkBleHBvcnQKZGVmIHRsdl9wYWNrKCphcmdzKToKICAgIGlmIGxlbihhcmdzKSA9PSAyOgogICAgICAgIHRsdiA9IHsndHlwZSc6YXJnc1swXSwgJ3ZhbHVlJzphcmdzWzFdfQogICAgZWxzZToKICAgICAgICB0bHYgPSBhcmdzWzBdCiAgICBkYXRhID0gJycKICAgIHZhbHVlID0gdGx2Wyd2YWx1ZSddCiAgICBpZiAodGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX1VJTlQpID09IFRMVl9NRVRBX1RZUEVfVUlOVDoKICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCBmbG9hdCk6CiAgICAgICAgICAgIHZhbHVlID0gaW50KHJvdW5kKHZhbHVlKSkKICAgICAgICBkYXRhID0gc3RydWN0LnBhY2soJz5JSUknLCAxMiwgdGx2Wyd0eXBlJ10sIHZhbHVlKQogICAgZWxpZiAodGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX1FXT1JEKSA9PSBUTFZfTUVUQV9UWVBFX1FXT1JEOgogICAgICAgIGRhdGEgPSBzdHJ1Y3QucGFjaygnPklJUScsIDE2LCB0bHZbJ3R5cGUnXSwgdmFsdWUpCiAgICBlbGlmICh0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfQk9PTCkgPT0gVExWX01FVEFfVFlQRV9CT09MOgogICAgICAgIGRhdGEgPSBzdHJ1Y3QucGFjaygnPklJJywgOSwgdGx2Wyd0eXBlJ10pICsgYnl0ZXMoY2hyKGludChib29sKHZhbHVlKSkpLCAnVVRGLTgnKQogICAgZWxzZToKICAgICAgICBpZiBzeXMudmVyc2lvbl9pbmZvWzBdIDwgMyBhbmQgdmFsdWUuX19jbGFzc19fLl9fbmFtZV9fID09ICd1bmljb2RlJzoKICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5lbmNvZGUoJ1VURi04JykKICAgICAgICBlbGlmIG5vdCBpc19ieXRlcyh2YWx1ZSk6CiAgICAgICAgICAgIHZhbHVlID0gYnl0ZXModmFsdWUsICdVVEYtOCcpCiAgICAgICAgaWYgKHRsdlsndHlwZSddICYgVExWX01FVEFfVFlQRV9TVFJJTkcpID09IFRMVl9NRVRBX1RZUEVfU1RSSU5HOgogICAgICAgICAgICBkYXRhID0gc3RydWN0LnBhY2soJz5JSScsIDggKyBsZW4odmFsdWUpICsgMSwgdGx2Wyd0eXBlJ10pICsgdmFsdWUgKyBOVUxMX0JZVEUKICAgICAgICBlbGlmICh0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfUkFXKSA9PSBUTFZfTUVUQV9UWVBFX1JBVzoKICAgICAgICAgICAgZGF0YSA9IHN0cnVjdC5wYWNrKCc+SUknLCA4ICsgbGVuKHZhbHVlKSwgdGx2Wyd0eXBlJ10pICsgdmFsdWUKICAgICAgICBlbGlmICh0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfR1JPVVApID09IFRMVl9NRVRBX1RZUEVfR1JPVVA6CiAgICAgICAgICAgIGRhdGEgPSBzdHJ1Y3QucGFjaygnPklJJywgOCArIGxlbih2YWx1ZSksIHRsdlsndHlwZSddKSArIHZhbHVlCiAgICAgICAgZWxpZiAodGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX0NPTVBMRVgpID09IFRMVl9NRVRBX1RZUEVfQ09NUExFWDoKICAgICAgICAgICAgZGF0YSA9IHN0cnVjdC5wYWNrKCc+SUknLCA4ICsgbGVuKHZhbHVlKSwgdGx2Wyd0eXBlJ10pICsgdmFsdWUKICAgIHJldHVybiBkYXRhCgpAZXhwb3J0CmRlZiB0bHZfcGFja19yZXNwb25zZShyZXN1bHQsIHJlc3BvbnNlKToKICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1JFU1VMVCwgcmVzdWx0KQogICAgcmVzcG9uc2UgPSBzdHJ1Y3QucGFjaygnPkknLCBsZW4ocmVzcG9uc2UpICsgNCkgKyByZXNwb25zZQogICAgcmV0dXJuIHJlc3BvbnNlCgojQGV4cG9ydApjbGFzcyBNZXRlcnByZXRlckZpbGUob2JqZWN0KToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBmaWxlX29iaik6CiAgICAgICAgc2VsZi5maWxlX29iaiA9IGZpbGVfb2JqCgogICAgZGVmIF9fZ2V0YXR0cl9fKHNlbGYsIG5hbWUpOgogICAgICAgIHJldHVybiBnZXRhdHRyKHNlbGYuZmlsZV9vYmosIG5hbWUpCmV4cG9ydChNZXRlcnByZXRlckZpbGUpCgojQGV4cG9ydApjbGFzcyBNZXRlcnByZXRlclNvY2tldChvYmplY3QpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHNvY2spOgogICAgICAgIHNlbGYuc29jayA9IHNvY2sKCiAgICBkZWYgX19nZXRhdHRyX18oc2VsZiwgbmFtZSk6CiAgICAgICAgcmV0dXJuIGdldGF0dHIoc2VsZi5zb2NrLCBuYW1lKQpleHBvcnQoTWV0ZXJwcmV0ZXJTb2NrZXQpCgojQGV4cG9ydApjbGFzcyBNZXRlcnByZXRlclNvY2tldENsaWVudChNZXRlcnByZXRlclNvY2tldCk6CiAgICBwYXNzCmV4cG9ydChNZXRlcnByZXRlclNvY2tldENsaWVudCkKCiNAZXhwb3J0CmNsYXNzIE1ldGVycHJldGVyU29ja2V0U2VydmVyKE1ldGVycHJldGVyU29ja2V0KToKICAgIHBhc3MKZXhwb3J0KE1ldGVycHJldGVyU29ja2V0U2VydmVyKQoKY2xhc3MgU1REUHJvY2Vzc0J1ZmZlcih0aHJlYWRpbmcuVGhyZWFkKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBzdGQsIGlzX2FsaXZlKToKICAgICAgICB0aHJlYWRpbmcuVGhyZWFkLl9faW5pdF9fKHNlbGYpCiAgICAgICAgc2VsZi5zdGQgPSBzdGQKICAgICAgICBzZWxmLmlzX2FsaXZlID0gaXNfYWxpdmUKICAgICAgICBzZWxmLmRhdGEgPSBieXRlcygpCiAgICAgICAgc2VsZi5kYXRhX2xvY2sgPSB0aHJlYWRpbmcuUkxvY2soKQoKICAgIGRlZiBydW4oc2VsZik6CiAgICAgICAgZm9yIGJ5dGUgaW4gaXRlcihsYW1iZGE6IHNlbGYuc3RkLnJlYWQoMSksIGJ5dGVzKCkpOgogICAgICAgICAgICBzZWxmLmRhdGFfbG9jay5hY3F1aXJlKCkKICAgICAgICAgICAgc2VsZi5kYXRhICs9IGJ5dGUKICAgICAgICAgICAgc2VsZi5kYXRhX2xvY2sucmVsZWFzZSgpCgogICAgZGVmIGlzX3JlYWRfcmVhZHkoc2VsZik6CiAgICAgICAgcmV0dXJuIGxlbihzZWxmLmRhdGEpICE9IDAKCiAgICBkZWYgcGVlayhzZWxmLCBsID0gTm9uZSk6CiAgICAgICAgZGF0YSA9IGJ5dGVzKCkKICAgICAgICBzZWxmLmRhdGFfbG9jay5hY3F1aXJlKCkKICAgICAgICBpZiBsID09IE5vbmU6CiAgICAgICAgICAgIGRhdGEgPSBzZWxmLmRhdGEKICAgICAgICBlbHNlOgogICAgICAgICAgICBkYXRhID0gc2VsZi5kYXRhWzA6bF0KICAgICAgICBzZWxmLmRhdGFfbG9jay5yZWxlYXNlKCkKICAgICAgICByZXR1cm4gZGF0YQoKICAgIGRlZiByZWFkKHNlbGYsIGwgPSBOb25lKToKICAgICAgICBzZWxmLmRhdGFfbG9jay5hY3F1aXJlKCkKICAgICAgICBkYXRhID0gc2VsZi5wZWVrKGwpCiAgICAgICAgc2VsZi5kYXRhID0gc2VsZi5kYXRhW2xlbihkYXRhKTpdCiAgICAgICAgc2VsZi5kYXRhX2xvY2sucmVsZWFzZSgpCiAgICAgICAgcmV0dXJuIGRhdGEKCiNAZXhwb3J0CmNsYXNzIFNURFByb2Nlc3Moc3VicHJvY2Vzcy5Qb3Blbik6CiAgICBkZWYgX19pbml0X18oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICBkZWJ1Z19wcmludCgnWypdIHN0YXJ0aW5nIHByb2Nlc3M6ICcgKyByZXByKGFyZ3NbMF0pKQogICAgICAgIHN1YnByb2Nlc3MuUG9wZW4uX19pbml0X18oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKQogICAgICAgIHNlbGYuZWNob19wcm90ZWN0aW9uID0gRmFsc2UKCiAgICBkZWYgc3RhcnQoc2VsZik6CiAgICAgICAgc2VsZi5zdGRvdXRfcmVhZGVyID0gU1REUHJvY2Vzc0J1ZmZlcihzZWxmLnN0ZG91dCwgbGFtYmRhOiBzZWxmLnBvbGwoKSA9PSBOb25lKQogICAgICAgIHNlbGYuc3Rkb3V0X3JlYWRlci5zdGFydCgpCiAgICAgICAgc2VsZi5zdGRlcnJfcmVhZGVyID0gU1REUHJvY2Vzc0J1ZmZlcihzZWxmLnN0ZGVyciwgbGFtYmRhOiBzZWxmLnBvbGwoKSA9PSBOb25lKQogICAgICAgIHNlbGYuc3RkZXJyX3JlYWRlci5zdGFydCgpCgogICAgZGVmIHdyaXRlKHNlbGYsIGNoYW5uZWxfZGF0YSk6CiAgICAgICAgc2VsZi5zdGRpbi53cml0ZShjaGFubmVsX2RhdGEpCiAgICAgICAgc2VsZi5zdGRpbi5mbHVzaCgpCiAgICAgICAgaWYgc2VsZi5lY2hvX3Byb3RlY3Rpb246CiAgICAgICAgICAgIGVuZF90aW1lID0gdGltZS50aW1lKCkgKyAwLjUKICAgICAgICAgICAgb3V0X2RhdGEgPSBieXRlcygpCiAgICAgICAgICAgIHdoaWxlICh0aW1lLnRpbWUoKSA8IGVuZF90aW1lKSBhbmQgKG91dF9kYXRhICE9IGNoYW5uZWxfZGF0YSk6CiAgICAgICAgICAgICAgICBpZiBzZWxmLnN0ZG91dF9yZWFkZXIuaXNfcmVhZF9yZWFkeSgpOgogICAgICAgICAgICAgICAgICAgIG91dF9kYXRhID0gc2VsZi5zdGRvdXRfcmVhZGVyLnBlZWsobGVuKGNoYW5uZWxfZGF0YSkpCiAgICAgICAgICAgIGlmIG91dF9kYXRhID09IGNoYW5uZWxfZGF0YToKICAgICAgICAgICAgICAgIHNlbGYuc3Rkb3V0X3JlYWRlci5yZWFkKGxlbihjaGFubmVsX2RhdGEpKQpleHBvcnQoU1REUHJvY2VzcykKCmNsYXNzIFRyYW5zcG9ydChvYmplY3QpOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYuY29tbXVuaWNhdGlvbl90aW1lb3V0ID0gU0VTU0lPTl9DT01NVU5JQ0FUSU9OX1RJTUVPVVQKICAgICAgICBzZWxmLmNvbW11bmljYXRpb25fbGFzdCA9IDAKICAgICAgICBzZWxmLnJldHJ5X3RvdGFsID0gU0VTU0lPTl9SRVRSWV9UT1RBTAogICAgICAgIHNlbGYucmV0cnlfd2FpdCA9IFNFU1NJT05fUkVUUllfV0FJVAogICAgICAgIHNlbGYucmVxdWVzdF9yZXRpcmUgPSBGYWxzZQoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToKICAgICAgICByZXR1cm4gIjx7MH0gdXJsPSd7MX0nID4iLmZvcm1hdChzZWxmLl9fY2xhc3NfXy5fX25hbWVfXywgc2VsZi51cmwpCgogICAgQHByb3BlcnR5CiAgICBkZWYgY29tbXVuaWNhdGlvbl9oYXNfZXhwaXJlZChzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5jb21tdW5pY2F0aW9uX2xhc3QgKyBzZWxmLmNvbW11bmljYXRpb25fdGltZW91dCA8IHRpbWUudGltZSgpCgogICAgQHByb3BlcnR5CiAgICBkZWYgc2hvdWxkX3JldGlyZShzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5jb21tdW5pY2F0aW9uX2hhc19leHBpcmVkIG9yIHNlbGYucmVxdWVzdF9yZXRpcmUKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZnJvbV9yZXF1ZXN0KHJlcXVlc3QpOgogICAgICAgIHVybCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX1VSTClbJ3ZhbHVlJ10KICAgICAgICBpZiB1cmwuc3RhcnRzd2l0aCgndGNwJyk6CiAgICAgICAgICAgIHRyYW5zcG9ydCA9IFRjcFRyYW5zcG9ydCh1cmwpCiAgICAgICAgZWxpZiB1cmwuc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICBwcm94eSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX1BST1hZX0hPU1QpLmdldCgndmFsdWUnKQogICAgICAgICAgICB1c2VyX2FnZW50ID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfVUEpLmdldCgndmFsdWUnLCBIVFRQX1VTRVJfQUdFTlQpCiAgICAgICAgICAgIGh0dHBfaGVhZGVycyA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX0hFQURFUlMpLmdldCgndmFsdWUnLCBOb25lKQogICAgICAgICAgICB0cmFuc3BvcnQgPSBIdHRwVHJhbnNwb3J0KHVybCwgcHJveHk9cHJveHksIHVzZXJfYWdlbnQ9dXNlcl9hZ2VudCkKICAgICAgICAgICAgaWYgaHR0cF9oZWFkZXJzOgogICAgICAgICAgICAgICAgaGVhZGVycyA9IHt9CiAgICAgICAgICAgICAgICBmb3IgaCBpbiBodHRwX2hlYWRlcnMuc3RyaXAoKS5zcGxpdCgiXHJcbiIpOgogICAgICAgICAgICAgICAgICAgIHAgPSBoLnNwbGl0KCc6JykKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzW3BbMF0udXBwZXIoKV0gPSAnJy5qb2luKHBbMTowXSkKICAgICAgICAgICAgICAgIGh0dHBfaG9zdCA9IGhlYWRlcnMuZ2V0KCdIT1NUJykKICAgICAgICAgICAgICAgIGh0dHBfY29va2llID0gaGVhZGVycy5nZXQoJ0NPT0tJRScpCiAgICAgICAgICAgICAgICBodHRwX3JlZmVyZXIgPSBoZWFkZXJzLmdldCgnUkVGRVJFUicpCiAgICAgICAgICAgICAgICB0cmFuc3BvcnQgPSBIdHRwVHJhbnNwb3J0KHVybCwgcHJveHk9cHJveHksIHVzZXJfYWdlbnQ9dXNlcl9hZ2VudCwgaHR0cF9ob3N0PWh0dHBfaG9zdCwKICAgICAgICAgICAgICAgICAgICAgICAgaHR0cF9jb29raWU9aHR0cF9jb29raWUsIGh0dHBfcmVmZXJlcj1odHRwX3JlZmVyZXIpCiAgICAgICAgdHJhbnNwb3J0LmNvbW11bmljYXRpb25fdGltZW91dCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX0NPTU1fVElNRU9VVCkuZ2V0KCd2YWx1ZScsIFNFU1NJT05fQ09NTVVOSUNBVElPTl9USU1FT1VUKQogICAgICAgIHRyYW5zcG9ydC5yZXRyeV90b3RhbCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX1JFVFJZX1RPVEFMKS5nZXQoJ3ZhbHVlJywgU0VTU0lPTl9SRVRSWV9UT1RBTCkKICAgICAgICB0cmFuc3BvcnQucmV0cnlfd2FpdCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX1JFVFJZX1dBSVQpLmdldCgndmFsdWUnLCBTRVNTSU9OX1JFVFJZX1dBSVQpCiAgICAgICAgcmV0dXJuIHRyYW5zcG9ydAoKICAgIGRlZiBfYWN0aXZhdGUoc2VsZik6CiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgYWN0aXZhdGUoc2VsZik6CiAgICAgICAgZW5kX3RpbWUgPSB0aW1lLnRpbWUoKSArIHNlbGYucmV0cnlfdG90YWwKICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSA8IGVuZF90aW1lOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhY3RpdmF0ZV9zdWNjZWVkZWQgPSBzZWxmLl9hY3RpdmF0ZSgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFjdGl2YXRlX3N1Y2NlZWRlZCA9IEZhbHNlCiAgICAgICAgICAgIGlmIGFjdGl2YXRlX3N1Y2NlZWRlZDoKICAgICAgICAgICAgICAgIHNlbGYuY29tbXVuaWNhdGlvbl9sYXN0ID0gdGltZS50aW1lKCkKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIHRpbWUuc2xlZXAoc2VsZi5yZXRyeV93YWl0KQogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfZGVhY3RpdmF0ZShzZWxmKToKICAgICAgICByZXR1cm4KCiAgICBkZWYgZGVhY3RpdmF0ZShzZWxmKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuX2RlYWN0aXZhdGUoKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgICAgIHNlbGYuY29tbXVuaWNhdGlvbl9sYXN0ID0gMAogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIGRlY3J5cHRfcGFja2V0KHNlbGYsIHBrdCk6CiAgICAgICAgaWYgcGt0IGFuZCBsZW4ocGt0KSA+IFBBQ0tFVF9IRUFERVJfU0laRToKICAgICAgICAgICAgIyBXZSBkb24ndCBzdXBwb3J0IEFFUyBlbmNyeXB0aW9uIHlldCwgc28ganVzdCBkbyB0aGUgbm9ybWFsCiAgICAgICAgICAgICMgWE9SIHRoaW5nIGFuZCBtb3ZlIG9uCiAgICAgICAgICAgIHhvcl9rZXkgPSBzdHJ1Y3QudW5wYWNrKCdCQkJCJywgcGt0WzpQQUNLRVRfWE9SX0tFWV9TSVpFXSkKICAgICAgICAgICAgcmF3ID0geG9yX2J5dGVzKHhvcl9rZXksIHBrdCkKICAgICAgICAgICAgcmV0dXJuIHJhd1tQQUNLRVRfSEVBREVSX1NJWkU6XQogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIGdldF9wYWNrZXQoc2VsZik6CiAgICAgICAgc2VsZi5yZXF1ZXN0X3JldGlyZSA9IEZhbHNlCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwa3QgPSBzZWxmLmRlY3J5cHRfcGFja2V0KHNlbGYuX2dldF9wYWNrZXQoKSkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGRlYnVnX3RyYWNlYmFjaygpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgaWYgcGt0IGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgc2VsZi5jb21tdW5pY2F0aW9uX2xhc3QgPSB0aW1lLnRpbWUoKQogICAgICAgIHJldHVybiBwa3QKCiAgICBkZWYgZW5jcnlwdF9wYWNrZXQoc2VsZiwgcGt0KToKICAgICAgICAjIFRoZSBwYWNrZXQgbm93IGhhcyB0byBjb250YWluIHNlc3Npb24gR1VJRCBhbmQgZW5jcnlwdGlvbiBmbGFnIGluZm8KICAgICAgICAjIEFuZCBnaXZlbiB0aGF0IHdlJ3JlIG5vdCB5ZXQgc3VwcG9ydGluZyBBRVMsIHdlJ3JlIGdvaW5nIHRvIGp1c3QKICAgICAgICAjIGFsd2F5cyByZXR1cm4gdGhlIHNlc3Npb24gZ3VpZCBhbmQgdGhlIGVuY3J5cHRpb24gZmxhZyBzZXQgdG8gMAogICAgICAgICMgVE9ETzogd2UnbGwgYWRkIGVuY3J5cHRpb24gc29vbiEKICAgICAgICB4b3Jfa2V5ID0gcmFuZF94b3Jfa2V5KCkKICAgICAgICByYXcgPSBiaW5hc2NpaS5hMmJfaGV4KGJ5dGVzKFNFU1NJT05fR1VJRCwgJ1VURi04JykpICsgc3RydWN0LnBhY2soJz5JJywgRU5DX05PTkUpICsgcGt0CiAgICAgICAgcmVzdWx0ID0gc3RydWN0LnBhY2soJ0JCQkInLCAqeG9yX2tleSkgKyB4b3JfYnl0ZXMoeG9yX2tleSwgcmF3KQogICAgICAgIHJldHVybiByZXN1bHQKCiAgICBkZWYgc2VuZF9wYWNrZXQoc2VsZiwgcGt0KToKICAgICAgICBzZWxmLnJlcXVlc3RfcmV0aXJlID0gRmFsc2UKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuX3NlbmRfcGFja2V0KHNlbGYuZW5jcnlwdF9wYWNrZXQocGt0KSkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGRlYnVnX3RyYWNlYmFjaygpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIHNlbGYuY29tbXVuaWNhdGlvbl9sYXN0ID0gdGltZS50aW1lKCkKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiB0bHZfcGFja190aW1lb3V0cyhzZWxmKToKICAgICAgICByZXNwb25zZSAgPSB0bHZfcGFjayhUTFZfVFlQRV9UUkFOU19DT01NX1RJTUVPVVQsIHNlbGYuY29tbXVuaWNhdGlvbl90aW1lb3V0KQogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX1JFVFJZX1RPVEFMLCBzZWxmLnJldHJ5X3RvdGFsKQogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX1JFVFJZX1dBSVQsIHNlbGYucmV0cnlfd2FpdCkKICAgICAgICByZXR1cm4gcmVzcG9uc2UKCiAgICBkZWYgdGx2X3BhY2tfdHJhbnNwb3J0X2dyb3VwKHNlbGYpOgogICAgICAgIHRyYW5zX2dyb3VwICA9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX1VSTCwgc2VsZi51cmwpCiAgICAgICAgdHJhbnNfZ3JvdXAgKz0gc2VsZi50bHZfcGFja190aW1lb3V0cygpCiAgICAgICAgcmV0dXJuIHRyYW5zX2dyb3VwCgpjbGFzcyBIdHRwVHJhbnNwb3J0KFRyYW5zcG9ydCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgdXJsLCBwcm94eT1Ob25lLCB1c2VyX2FnZW50PU5vbmUsIGh0dHBfaG9zdD1Ob25lLCBodHRwX3JlZmVyZXI9Tm9uZSwgaHR0cF9jb29raWU9Tm9uZSk6CiAgICAgICAgc3VwZXIoSHR0cFRyYW5zcG9ydCwgc2VsZikuX19pbml0X18oKQogICAgICAgIG9wZW5lcl9hcmdzID0gW10KICAgICAgICBzY2hlbWUgPSB1cmwuc3BsaXQoJzonLCAxKVswXQogICAgICAgIGlmIHNjaGVtZSA9PSAnaHR0cHMnIGFuZCAoKHN5cy52ZXJzaW9uX2luZm9bMF0gPT0gMiBhbmQgc3lzLnZlcnNpb25faW5mbyA+PSAoMiwgNywgOSkpIG9yIHN5cy52ZXJzaW9uX2luZm8gPj0gKDMsIDQsIDMpKToKICAgICAgICAgICAgaW1wb3J0IHNzbAogICAgICAgICAgICBzc2xfY3R4ID0gc3NsLlNTTENvbnRleHQoc3NsLlBST1RPQ09MX1NTTHYyMykKICAgICAgICAgICAgc3NsX2N0eC5jaGVja19ob3N0bmFtZSA9IEZhbHNlCiAgICAgICAgICAgIHNzbF9jdHgudmVyaWZ5X21vZGUgPSBzc2wuQ0VSVF9OT05FCiAgICAgICAgICAgIG9wZW5lcl9hcmdzLmFwcGVuZCh1cmxsaWIuSFRUUFNIYW5kbGVyKDAsIHNzbF9jdHgpKQogICAgICAgIGlmIHByb3h5OgogICAgICAgICAgICBvcGVuZXJfYXJncy5hcHBlbmQodXJsbGliLlByb3h5SGFuZGxlcih7c2NoZW1lOiBwcm94eX0pKQogICAgICAgIHNlbGYucHJveHkgPSBwcm94eQogICAgICAgIG9wZW5lciA9IHVybGxpYi5idWlsZF9vcGVuZXIoKm9wZW5lcl9hcmdzKQogICAgICAgIG9wZW5lci5hZGRoZWFkZXJzID0gW10KICAgICAgICBpZiB1c2VyX2FnZW50OgogICAgICAgICAgICBvcGVuZXIuYWRkaGVhZGVycy5hcHBlbmQoKCdVc2VyLUFnZW50JywgdXNlcl9hZ2VudCkpCiAgICAgICAgaWYgaHR0cF9jb29raWU6CiAgICAgICAgICAgIG9wZW5lci5hZGRoZWFkZXJzLmFwcGVuZCgoJ0Nvb2tpZScsIGh0dHBfY29va2llKSkKICAgICAgICBpZiBodHRwX3JlZmVyZXI6CiAgICAgICAgICAgIG9wZW5lci5hZGRoZWFkZXJzLmFwcGVuZCgoJ1JlZmVyZXInLCBodHRwX3JlZmVyZXIpKQogICAgICAgIHNlbGYudXNlcl9hZ2VudCA9IHVzZXJfYWdlbnQKICAgICAgICB1cmxsaWIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQogICAgICAgIHNlbGYudXJsID0gdXJsCiAgICAgICAgc2VsZi5faHR0cF9yZXF1ZXN0X2hlYWRlcnMgPSB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nfQogICAgICAgIGlmIGh0dHBfaG9zdDoKICAgICAgICAgICAgc2VsZi5faHR0cF9yZXF1ZXN0X2hlYWRlcnNbJ0hvc3QnXSA9IGh0dHBfaG9zdAogICAgICAgIHNlbGYuX2ZpcnN0X3BhY2tldCA9IE5vbmUKICAgICAgICBzZWxmLl9lbXB0eV9jbnQgPSAwCgogICAgZGVmIF9hY3RpdmF0ZShzZWxmKToKICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIHNlbGYuX2ZpcnN0X3BhY2tldCA9IE5vbmUKICAgICAgICBwYWNrZXQgPSBzZWxmLl9nZXRfcGFja2V0KCkKICAgICAgICBpZiBwYWNrZXQgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgc2VsZi5fZmlyc3RfcGFja2V0ID0gcGFja2V0CiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgX2dldF9wYWNrZXQoc2VsZik6CiAgICAgICAgaWYgc2VsZi5fZmlyc3RfcGFja2V0OgogICAgICAgICAgICBwYWNrZXQgPSBzZWxmLl9maXJzdF9wYWNrZXQKICAgICAgICAgICAgc2VsZi5fZmlyc3RfcGFja2V0ID0gTm9uZQogICAgICAgICAgICByZXR1cm4gcGFja2V0CiAgICAgICAgcGFja2V0ID0gTm9uZQogICAgICAgIHhvcl9rZXkgPSBOb25lCiAgICAgICAgcmVxdWVzdCA9IHVybGxpYi5SZXF1ZXN0KHNlbGYudXJsLCBOb25lLCBzZWxmLl9odHRwX3JlcXVlc3RfaGVhZGVycykKICAgICAgICB0cnk6CiAgICAgICAgICAgIHVybF9oID0gdXJsbGliLnVybG9wZW4ocmVxdWVzdCwgdGltZW91dD1zZWxmLmNvbW11bmljYXRpb25fdGltZW91dCkKICAgICAgICAgICAgcGFja2V0ID0gdXJsX2gucmVhZCgpCiAgICAgICAgICAgIGZvciBfIGluIHJhbmdlKDEpOgogICAgICAgICAgICAgICAgaWYgcGFja2V0ID09ICcnOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBpZiBsZW4ocGFja2V0KSA8IFBBQ0tFVF9IRUFERVJfU0laRToKICAgICAgICAgICAgICAgICAgICBwYWNrZXQgPSBOb25lICAjIGxvb2tzIGNvcnJ1cHQKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgeG9yX2tleSA9IHN0cnVjdC51bnBhY2soJ0JCQkInLCBwYWNrZXRbOlBBQ0tFVF9YT1JfS0VZX1NJWkVdKQogICAgICAgICAgICAgICAgaGVhZGVyID0geG9yX2J5dGVzKHhvcl9rZXksIHBhY2tldFs6UEFDS0VUX0hFQURFUl9TSVpFXSkKICAgICAgICAgICAgICAgIHBrdF9sZW5ndGggPSBzdHJ1Y3QudW5wYWNrKCc+SScsIGhlYWRlcltQQUNLRVRfTEVOR1RIX09GRjpQQUNLRVRfTEVOR1RIX09GRitQQUNLRVRfTEVOR1RIX1NJWkVdKVswXSAtIDgKICAgICAgICAgICAgICAgIGlmIGxlbihwYWNrZXQpICE9IChwa3RfbGVuZ3RoICsgUEFDS0VUX0hFQURFUl9TSVpFKToKICAgICAgICAgICAgICAgICAgICBwYWNrZXQgPSBOb25lICAjIGxvb2tzIGNvcnJ1cHQKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGRlYnVnX3RyYWNlYmFjaygnRmFpbHVyZSB0byByZWNlaXZlIHBhY2tldCBmcm9tICcgKyBzZWxmLnVybCkKCiAgICAgICAgaWYgbm90IHBhY2tldDoKICAgICAgICAgICAgZGVsYXkgPSAxMCAqIHNlbGYuX2VtcHR5X2NudAogICAgICAgICAgICBpZiBzZWxmLl9lbXB0eV9jbnQgPj0gMDoKICAgICAgICAgICAgICAgIGRlbGF5ICo9IDEwCiAgICAgICAgICAgIHNlbGYuX2VtcHR5X2NudCArPSAxCiAgICAgICAgICAgIHRpbWUuc2xlZXAoZmxvYXQobWluKDEwMDAwLCBkZWxheSkpIC8gMTAwMCkKICAgICAgICAgICAgcmV0dXJuIHBhY2tldAoKICAgICAgICBzZWxmLl9lbXB0eV9jbnQgPSAwCiAgICAgICAgcmV0dXJuIHBhY2tldAoKICAgIGRlZiBfc2VuZF9wYWNrZXQoc2VsZiwgcGFja2V0KToKICAgICAgICByZXF1ZXN0ID0gdXJsbGliLlJlcXVlc3Qoc2VsZi51cmwsIHBhY2tldCwgc2VsZi5faHR0cF9yZXF1ZXN0X2hlYWRlcnMpCiAgICAgICAgdXJsX2ggPSB1cmxsaWIudXJsb3BlbihyZXF1ZXN0LCB0aW1lb3V0PXNlbGYuY29tbXVuaWNhdGlvbl90aW1lb3V0KQogICAgICAgIHJlc3BvbnNlID0gdXJsX2gucmVhZCgpCgogICAgZGVmIHBhdGNoX3VyaV9wYXRoKHNlbGYsIG5ld19wYXRoKToKICAgICAgICBtYXRjaCA9IHJlLm1hdGNoKHInaHR0cHM/Oi8vW14vXSsoLy4qJCknLCBzZWxmLnVybCkKICAgICAgICBpZiBtYXRjaCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBzZWxmLnVybCA9IHNlbGYudXJsWzptYXRjaC5zcGFuKDEpWzBdXSArIG5ld19wYXRoCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgdGx2X3BhY2tfdHJhbnNwb3J0X2dyb3VwKHNlbGYpOgogICAgICAgIHRyYW5zX2dyb3VwICA9IHN1cGVyKEh0dHBUcmFuc3BvcnQsIHNlbGYpLnRsdl9wYWNrX3RyYW5zcG9ydF9ncm91cCgpCiAgICAgICAgaWYgc2VsZi51c2VyX2FnZW50OgogICAgICAgICAgICB0cmFuc19ncm91cCArPSB0bHZfcGFjayhUTFZfVFlQRV9UUkFOU19VQSwgc2VsZi51c2VyX2FnZW50KQogICAgICAgIGlmIHNlbGYucHJveHk6CiAgICAgICAgICAgIHRyYW5zX2dyb3VwICs9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX1BST1hZX0hPU1QsIHNlbGYucHJveHkpCiAgICAgICAgcmV0dXJuIHRyYW5zX2dyb3VwCgpjbGFzcyBUY3BUcmFuc3BvcnQoVHJhbnNwb3J0KToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB1cmwsIHNvY2tldD1Ob25lKToKICAgICAgICBzdXBlcihUY3BUcmFuc3BvcnQsIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLnVybCA9IHVybAogICAgICAgIHNlbGYuc29ja2V0ID0gc29ja2V0CiAgICAgICAgc2VsZi5fY2xlYW51cF90aHJlYWQgPSBOb25lCiAgICAgICAgc2VsZi5fZmlyc3RfcGFja2V0ID0gVHJ1ZQoKICAgIGRlZiBfc29ja19jbGVhbnVwKHNlbGYsIHNvY2spOgogICAgICAgIHJlbWFpbmluZ190aW1lID0gc2VsZi5jb21tdW5pY2F0aW9uX3RpbWVvdXQKICAgICAgICB3aGlsZSByZW1haW5pbmdfdGltZSA+IDA6CiAgICAgICAgICAgIGl0ZXJfc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIGlmIHNlbGVjdC5zZWxlY3QoW3NvY2tdLCBbXSwgW10sIHJlbWFpbmluZ190aW1lKVswXToKICAgICAgICAgICAgICAgIGlmIGxlbihzb2NrLnJlY3YoNDA5NikpID09IDA6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgcmVtYWluaW5nX3RpbWUgLT0gdGltZS50aW1lKCkgLSBpdGVyX3N0YXJ0X3RpbWUKICAgICAgICBzb2NrLmNsb3NlKCkKCiAgICBkZWYgX2FjdGl2YXRlKHNlbGYpOgogICAgICAgIGFkZHJlc3MsIHBvcnQgPSBzZWxmLnVybFs2Ol0ucnNwbGl0KCc6JywgMSkKICAgICAgICBwb3J0ID0gaW50KHBvcnQucnN0cmlwKCcvJykpCiAgICAgICAgdGltZW91dCA9IG1heChzZWxmLmNvbW11bmljYXRpb25fdGltZW91dCwgMzApCiAgICAgICAgaWYgYWRkcmVzcyBpbiAoJycsICcwLjAuMC4wJywgJzo6Jyk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlcnZlcl9zb2NrID0gc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVDYsIHNvY2tldC5TT0NLX1NUUkVBTSkKICAgICAgICAgICAgICAgIHNlcnZlcl9zb2NrLnNldHNvY2tvcHQoc29ja2V0LklQUFJPVE9fSVBWNiwgc29ja2V0LklQVjZfVjZPTkxZLCAwKQogICAgICAgICAgICBleGNlcHQgKEF0dHJpYnV0ZUVycm9yLCBzb2NrZXQuZXJyb3IpOgogICAgICAgICAgICAgICAgc2VydmVyX3NvY2sgPSBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19TVFJFQU0pCiAgICAgICAgICAgIHNlcnZlcl9zb2NrLmJpbmQoKCcnLCBwb3J0KSkKICAgICAgICAgICAgc2VydmVyX3NvY2subGlzdGVuKDEpCiAgICAgICAgICAgIGlmIG5vdCBzZWxlY3Quc2VsZWN0KFtzZXJ2ZXJfc29ja10sIFtdLCBbXSwgdGltZW91dClbMF06CiAgICAgICAgICAgICAgICBzZXJ2ZXJfc29jay5jbG9zZSgpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgc29jaywgXyA9IHNlcnZlcl9zb2NrLmFjY2VwdCgpCiAgICAgICAgICAgIHNlcnZlcl9zb2NrLmNsb3NlKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiAnOicgaW4gYWRkcmVzczoKICAgICAgICAgICAgICAgIHNvY2sgPSBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVUNiwgc29ja2V0LlNPQ0tfU1RSRUFNKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc29jayA9IHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQsIHNvY2tldC5TT0NLX1NUUkVBTSkKICAgICAgICAgICAgc29jay5zZXR0aW1lb3V0KHRpbWVvdXQpCiAgICAgICAgICAgIHNvY2suY29ubmVjdCgoYWRkcmVzcywgcG9ydCkpCiAgICAgICAgICAgIHNvY2suc2V0dGltZW91dChOb25lKQogICAgICAgIHNlbGYuc29ja2V0ID0gc29jawogICAgICAgIHNlbGYuX2ZpcnN0X3BhY2tldCA9IFRydWUKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiBfZGVhY3RpdmF0ZShzZWxmKToKICAgICAgICBjbGVhbnVwID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VsZi5fc29ja19jbGVhbnVwLCBhcmdzPShzZWxmLnNvY2tldCwpKQogICAgICAgIGNsZWFudXAucnVuKCkKICAgICAgICBzZWxmLnNvY2tldCA9IE5vbmUKCiAgICBkZWYgX2dldF9wYWNrZXQoc2VsZik6CiAgICAgICAgZmlyc3QgPSBzZWxmLl9maXJzdF9wYWNrZXQKICAgICAgICBzZWxmLl9maXJzdF9wYWNrZXQgPSBGYWxzZQogICAgICAgIGlmIG5vdCBzZWxlY3Quc2VsZWN0KFtzZWxmLnNvY2tldF0sIFtdLCBbXSwgMC41KVswXToKICAgICAgICAgICAgcmV0dXJuIGJ5dGVzKCkKICAgICAgICBwYWNrZXQgPSBzZWxmLnNvY2tldC5yZWN2KFBBQ0tFVF9IRUFERVJfU0laRSkKICAgICAgICBpZiBwYWNrZXQgPT0gJyc6ICAjIHJlbW90ZSBpcyBjbG9zZWQKICAgICAgICAgICAgc2VsZi5yZXF1ZXN0X3JldGlyZSA9IFRydWUKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBpZiBsZW4ocGFja2V0KSAhPSBQQUNLRVRfSEVBREVSX1NJWkU6CiAgICAgICAgICAgIGlmIGZpcnN0IGFuZCBsZW4ocGFja2V0KSA9PSA0OgogICAgICAgICAgICAgICAgcmVjZWl2ZWQgPSAwCiAgICAgICAgICAgICAgICBoZWFkZXIgPSBwYWNrZXRbOjRdCiAgICAgICAgICAgICAgICBwa3RfbGVuZ3RoID0gc3RydWN0LnVucGFjaygnPkknLCBoZWFkZXIpWzBdCiAgICAgICAgICAgICAgICBzZWxmLnNvY2tldC5zZXR0aW1lb3V0KG1heChzZWxmLmNvbW11bmljYXRpb25fdGltZW91dCwgMzApKQogICAgICAgICAgICAgICAgd2hpbGUgcmVjZWl2ZWQgPCBwa3RfbGVuZ3RoOgogICAgICAgICAgICAgICAgICAgIHJlY2VpdmVkICs9IGxlbihzZWxmLnNvY2tldC5yZWN2KHBrdF9sZW5ndGggLSByZWNlaXZlZCkpCiAgICAgICAgICAgICAgICBzZWxmLnNvY2tldC5zZXR0aW1lb3V0KE5vbmUpCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fZ2V0X3BhY2tldCgpCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIHhvcl9rZXkgPSBzdHJ1Y3QudW5wYWNrKCdCQkJCJywgcGFja2V0WzpQQUNLRVRfWE9SX0tFWV9TSVpFXSkKICAgICAgICAjIFhPUiB0aGUgd2hvbGUgaGVhZGVyIGZpcnN0CiAgICAgICAgaGVhZGVyID0geG9yX2J5dGVzKHhvcl9rZXksIHBhY2tldFs6UEFDS0VUX0hFQURFUl9TSVpFXSkKICAgICAgICAjIEV4dHJhY3QganVzdCB0aGUgbGVuZ3RoCiAgICAgICAgcGt0X2xlbmd0aCA9IHN0cnVjdC51bnBhY2soJz5JJywgaGVhZGVyW1BBQ0tFVF9MRU5HVEhfT0ZGOlBBQ0tFVF9MRU5HVEhfT0ZGK1BBQ0tFVF9MRU5HVEhfU0laRV0pWzBdCiAgICAgICAgcGt0X2xlbmd0aCAtPSA4CiAgICAgICAgIyBSZWFkIHRoZSByZXN0IG9mIHRoZSBwYWNrZXQKICAgICAgICByZXN0ID0gYnl0ZXMoKQogICAgICAgIHdoaWxlIGxlbihyZXN0KSA8IHBrdF9sZW5ndGg6CiAgICAgICAgICAgIHJlc3QgKz0gc2VsZi5zb2NrZXQucmVjdihwa3RfbGVuZ3RoIC0gbGVuKHJlc3QpKQogICAgICAgICMgcmV0dXJuIHRoZSB3aG9sZSBwYWNrZXQsIGFzIGl0J3MgZGVjb2RlZCBzZXBhcmF0ZWx5CiAgICAgICAgcmV0dXJuIHBhY2tldCArIHJlc3QKCiAgICBkZWYgX3NlbmRfcGFja2V0KHNlbGYsIHBhY2tldCk6CiAgICAgICAgc2VsZi5zb2NrZXQuc2VuZChwYWNrZXQpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgZnJvbV9zb2NrZXQoY2xzLCBzb2NrKToKICAgICAgICB1cmwgPSAndGNwOi8vJwogICAgICAgIGFkZHJlc3MsIHBvcnQgPSBzb2NrLmdldHNvY2tuYW1lKClbOjJdCiAgICAgICAgIyB0aGlzIHdpbGwgbmVlZCB0byBiZSBjaGFuZ2VkIGlmIHRoZSBiaW5kIHN0YWdlciBldmVyIHN1cHBvcnRzIGJpbmRpbmcgdG8gYSBzcGVjaWZpYyBhZGRyZXNzCiAgICAgICAgaWYgbm90IGFkZHJlc3MgaW4gKCcnLCAnMC4wLjAuMCcsICc6OicpOgogICAgICAgICAgICBhZGRyZXNzLCBwb3J0ID0gc29jay5nZXRwZWVybmFtZSgpWzoyXQogICAgICAgIHVybCArPSBhZGRyZXNzICsgJzonICsgc3RyKHBvcnQpCiAgICAgICAgcmV0dXJuIGNscyh1cmwsIHNvY2spCgpjbGFzcyBQeXRob25NZXRlcnByZXRlcihvYmplY3QpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHRyYW5zcG9ydCk6CiAgICAgICAgc2VsZi50cmFuc3BvcnQgPSB0cmFuc3BvcnQKICAgICAgICBzZWxmLl90cmFuc3BvcnRfc2xlZXAgPSBOb25lCiAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICBzZWxmLmxhc3RfcmVnaXN0ZXJlZF9leHRlbnNpb24gPSBOb25lCiAgICAgICAgc2VsZi5leHRlbnNpb25fZnVuY3Rpb25zID0ge30KICAgICAgICBzZWxmLmNoYW5uZWxzID0ge30KICAgICAgICBzZWxmLm5leHRfY2hhbm5lbF9pZCA9IDEKICAgICAgICBzZWxmLmludGVyYWN0X2NoYW5uZWxzID0gW10KICAgICAgICBzZWxmLnByb2Nlc3NlcyA9IHt9CiAgICAgICAgc2VsZi5uZXh0X3Byb2Nlc3NfaWQgPSAxCiAgICAgICAgc2VsZi50cmFuc3BvcnRzID0gW3NlbGYudHJhbnNwb3J0XQogICAgICAgIHNlbGYuc2Vzc2lvbl9leHBpcnlfdGltZSA9IFNFU1NJT05fRVhQSVJBVElPTl9USU1FT1VUCiAgICAgICAgc2VsZi5zZXNzaW9uX2V4cGlyeV9lbmQgPSB0aW1lLnRpbWUoKSArIHNlbGYuc2Vzc2lvbl9leHBpcnlfdGltZQogICAgICAgIGZvciBmdW5jIGluIGxpc3QoZmlsdGVyKGxhbWJkYSB4OiB4LnN0YXJ0c3dpdGgoJ19jb3JlJyksIGRpcihzZWxmKSkpOgogICAgICAgICAgICBzZWxmLmV4dGVuc2lvbl9mdW5jdGlvbnNbZnVuY1sxOl1dID0gZ2V0YXR0cihzZWxmLCBmdW5jKQogICAgICAgIHNlbGYucnVubmluZyA9IFRydWUKCiAgICBkZWYgcmVnaXN0ZXJfZXh0ZW5zaW9uKHNlbGYsIGV4dGVuc2lvbl9uYW1lKToKICAgICAgICBzZWxmLmxhc3RfcmVnaXN0ZXJlZF9leHRlbnNpb24gPSBleHRlbnNpb25fbmFtZQogICAgICAgIHJldHVybiBzZWxmLmxhc3RfcmVnaXN0ZXJlZF9leHRlbnNpb24KCiAgICBkZWYgcmVnaXN0ZXJfZnVuY3Rpb24oc2VsZiwgZnVuYyk6CiAgICAgICAgc2VsZi5leHRlbnNpb25fZnVuY3Rpb25zW2Z1bmMuX19uYW1lX19dID0gZnVuYwogICAgICAgIHJldHVybiBmdW5jCgogICAgZGVmIHJlZ2lzdGVyX2Z1bmN0aW9uX2lmKHNlbGYsIGNvbmRpdGlvbik6CiAgICAgICAgaWYgY29uZGl0aW9uOgogICAgICAgICAgICByZXR1cm4gc2VsZi5yZWdpc3Rlcl9mdW5jdGlvbgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBsYW1iZGEgZnVuY3Rpb246IGZ1bmN0aW9uCgogICAgZGVmIHJlZ2lzdGVyX2Z1bmN0aW9uX3dpbmRsbChzZWxmLCBmdW5jKToKICAgICAgICBpZiBoYXNfd2luZGxsOgogICAgICAgICAgICBzZWxmLnJlZ2lzdGVyX2Z1bmN0aW9uKGZ1bmMpCiAgICAgICAgcmV0dXJuIGZ1bmMKCiAgICBkZWYgYWRkX2NoYW5uZWwoc2VsZiwgY2hhbm5lbCk6CiAgICAgICAgYXNzZXJ0KGlzaW5zdGFuY2UoY2hhbm5lbCwgKHN1YnByb2Nlc3MuUG9wZW4sIE1ldGVycHJldGVyRmlsZSwgTWV0ZXJwcmV0ZXJTb2NrZXQpKSkKICAgICAgICBpZHggPSBzZWxmLm5leHRfY2hhbm5lbF9pZAogICAgICAgIHNlbGYuY2hhbm5lbHNbaWR4XSA9IGNoYW5uZWwKICAgICAgICBkZWJ1Z19wcmludCgnWypdIGFkZGVkIGNoYW5uZWwgaWQ6ICcgKyBzdHIoaWR4KSArICcgdHlwZTogJyArIGNoYW5uZWwuX19jbGFzc19fLl9fbmFtZV9fKQogICAgICAgIHNlbGYubmV4dF9jaGFubmVsX2lkICs9IDEKICAgICAgICByZXR1cm4gaWR4CgogICAgZGVmIGFkZF9wcm9jZXNzKHNlbGYsIHByb2Nlc3MpOgogICAgICAgIGlkeCA9IHNlbGYubmV4dF9wcm9jZXNzX2lkCiAgICAgICAgc2VsZi5wcm9jZXNzZXNbaWR4XSA9IHByb2Nlc3MKICAgICAgICBkZWJ1Z19wcmludCgnWypdIGFkZGVkIHByb2Nlc3MgaWQ6ICcgKyBzdHIoaWR4KSkKICAgICAgICBzZWxmLm5leHRfcHJvY2Vzc19pZCArPSAxCiAgICAgICAgcmV0dXJuIGlkeAoKICAgIGRlZiBnZXRfcGFja2V0KHNlbGYpOgogICAgICAgIHBrdCA9IHNlbGYudHJhbnNwb3J0LmdldF9wYWNrZXQoKQogICAgICAgIGlmIHBrdCBpcyBOb25lIGFuZCBzZWxmLnRyYW5zcG9ydC5zaG91bGRfcmV0aXJlOgogICAgICAgICAgICBzZWxmLnRyYW5zcG9ydF9jaGFuZ2UoKQogICAgICAgIHJldHVybiBwa3QKCiAgICBkZWYgc2VuZF9wYWNrZXQoc2VsZiwgcGFja2V0KToKICAgICAgICBzZW5kX3N1Y2NlZWRlZCA9IHNlbGYudHJhbnNwb3J0LnNlbmRfcGFja2V0KHBhY2tldCkKICAgICAgICBpZiBub3Qgc2VuZF9zdWNjZWVkZWQgYW5kIHNlbGYudHJhbnNwb3J0LnNob3VsZF9yZXRpcmU6CiAgICAgICAgICAgIHNlbGYudHJhbnNwb3J0X2NoYW5nZSgpCiAgICAgICAgcmV0dXJuIHNlbmRfc3VjY2VlZGVkCgogICAgQHByb3BlcnR5CiAgICBkZWYgc2Vzc2lvbl9oYXNfZXhwaXJlZChzZWxmKToKICAgICAgICBpZiBzZWxmLnNlc3Npb25fZXhwaXJ5X3RpbWUgPT0gMDoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgcmV0dXJuIHRpbWUudGltZSgpID4gc2VsZi5zZXNzaW9uX2V4cGlyeV9lbmQKCiAgICBkZWYgdHJhbnNwb3J0X2FkZChzZWxmLCBuZXdfdHJhbnNwb3J0KToKICAgICAgICBuZXdfcG9zaXRpb24gPSBzZWxmLnRyYW5zcG9ydHMuaW5kZXgoc2VsZi50cmFuc3BvcnQpCiAgICAgICAgc2VsZi50cmFuc3BvcnRzLmluc2VydChuZXdfcG9zaXRpb24sIG5ld190cmFuc3BvcnQpCgogICAgZGVmIHRyYW5zcG9ydF9jaGFuZ2Uoc2VsZiwgbmV3X3RyYW5zcG9ydD1Ob25lKToKICAgICAgICBpZiBuZXdfdHJhbnNwb3J0IGlzIE5vbmU6CiAgICAgICAgICAgIG5ld190cmFuc3BvcnQgPSBzZWxmLnRyYW5zcG9ydF9uZXh0KCkKICAgICAgICBzZWxmLnRyYW5zcG9ydC5kZWFjdGl2YXRlKCkKICAgICAgICBkZWJ1Z19wcmludCgnWypdIGNoYW5naW5nIHRyYW5zcG9ydCB0bzogJyArIG5ld190cmFuc3BvcnQudXJsKQogICAgICAgIHdoaWxlIG5vdCBuZXdfdHJhbnNwb3J0LmFjdGl2YXRlKCk6CiAgICAgICAgICAgIG5ld190cmFuc3BvcnQgPSBzZWxmLnRyYW5zcG9ydF9uZXh0KG5ld190cmFuc3BvcnQpCiAgICAgICAgICAgIGRlYnVnX3ByaW50KCdbKl0gY2hhbmdpbmcgdHJhbnNwb3J0IHRvOiAnICsgbmV3X3RyYW5zcG9ydC51cmwpCiAgICAgICAgc2VsZi50cmFuc3BvcnQgPSBuZXdfdHJhbnNwb3J0CgogICAgZGVmIHRyYW5zcG9ydF9uZXh0KHNlbGYsIGN1cnJlbnRfdHJhbnNwb3J0PU5vbmUpOgogICAgICAgIGlmIGN1cnJlbnRfdHJhbnNwb3J0IGlzIE5vbmU6CiAgICAgICAgICAgIGN1cnJlbnRfdHJhbnNwb3J0ID0gc2VsZi50cmFuc3BvcnQKICAgICAgICBuZXdfaWR4ID0gc2VsZi50cmFuc3BvcnRzLmluZGV4KGN1cnJlbnRfdHJhbnNwb3J0KSArIDEKICAgICAgICBpZiBuZXdfaWR4ID09IGxlbihzZWxmLnRyYW5zcG9ydHMpOgogICAgICAgICAgICBuZXdfaWR4ID0gMAogICAgICAgIHJldHVybiBzZWxmLnRyYW5zcG9ydHNbbmV3X2lkeF0KCiAgICBkZWYgdHJhbnNwb3J0X3ByZXYoc2VsZiwgY3VycmVudF90cmFuc3BvcnQ9Tm9uZSk6CiAgICAgICAgaWYgY3VycmVudF90cmFuc3BvcnQgaXMgTm9uZToKICAgICAgICAgICAgY3VycmVudF90cmFuc3BvcnQgPSBzZWxmLnRyYW5zcG9ydAogICAgICAgIG5ld19pZHggPSBzZWxmLnRyYW5zcG9ydHMuaW5kZXgoY3VycmVudF90cmFuc3BvcnQpIC0gMQogICAgICAgIGlmIG5ld19pZHggPT0gLTE6CiAgICAgICAgICAgIG5ld19pZHggPSBsZW4oc2VsZi50cmFuc3BvcnRzKSAtIDEKICAgICAgICByZXR1cm4gc2VsZi50cmFuc3BvcnRzW25ld19pZHhdCgogICAgZGVmIHJ1bihzZWxmKToKICAgICAgICB3aGlsZSBzZWxmLnJ1bm5pbmcgYW5kIG5vdCBzZWxmLnNlc3Npb25faGFzX2V4cGlyZWQ6CiAgICAgICAgICAgIHJlcXVlc3QgPSBzZWxmLmdldF9wYWNrZXQoKQogICAgICAgICAgICBpZiByZXF1ZXN0OgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLmNyZWF0ZV9yZXNwb25zZShyZXF1ZXN0KQogICAgICAgICAgICAgICAgaWYgcmVzcG9uc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX3BhY2tldChyZXNwb25zZSkKICAgICAgICAgICAgICAgIGlmIHNlbGYuX3RyYW5zcG9ydF9zbGVlcDoKICAgICAgICAgICAgICAgICAgICBzZWxmLnRyYW5zcG9ydC5kZWFjdGl2YXRlKCkKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKHNlbGYuX3RyYW5zcG9ydF9zbGVlcCkKICAgICAgICAgICAgICAgICAgICBzZWxmLl90cmFuc3BvcnRfc2xlZXAgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYudHJhbnNwb3J0LmFjdGl2YXRlKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHJhbnNwb3J0X2NoYW5nZSgpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAjIGl0ZXJhdGUgb3ZlciB0aGUga2V5cyBiZWNhdXNlIHNlbGYuY2hhbm5lbHMgY291bGQgYmUgbW9kaWZpZWQgaWYgb25lIGlzIGNsb3NlZAogICAgICAgICAgICBjaGFubmVsX2lkcyA9IGxpc3Qoc2VsZi5jaGFubmVscy5rZXlzKCkpCiAgICAgICAgICAgIGZvciBjaGFubmVsX2lkIGluIGNoYW5uZWxfaWRzOgogICAgICAgICAgICAgICAgY2hhbm5lbCA9IHNlbGYuY2hhbm5lbHNbY2hhbm5lbF9pZF0KICAgICAgICAgICAgICAgIGRhdGEgPSBieXRlcygpCiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGNoYW5uZWwsIFNURFByb2Nlc3MpOgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjaGFubmVsX2lkIGluIHNlbGYuaW50ZXJhY3RfY2hhbm5lbHM6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgaWYgY2hhbm5lbC5zdGRlcnJfcmVhZGVyLmlzX3JlYWRfcmVhZHkoKToKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGNoYW5uZWwuc3RkZXJyX3JlYWRlci5yZWFkKCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNoYW5uZWwuc3Rkb3V0X3JlYWRlci5pc19yZWFkX3JlYWR5KCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBjaGFubmVsLnN0ZG91dF9yZWFkZXIucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaGFubmVsLnBvbGwoKSAhPSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZV9kZWFkX3Jlc291cmNlX2NoYW5uZWwoY2hhbm5lbF9pZCkKICAgICAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShjaGFubmVsLCBNZXRlcnByZXRlclNvY2tldENsaWVudCk6CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgc2VsZWN0LnNlbGVjdChbY2hhbm5lbC5maWxlbm8oKV0sIFtdLCBbXSwgMClbMF06CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBjaGFubmVsLnJlY3YoMSkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IHNvY2tldC5lcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBieXRlcygpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihkKSA9PSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVfZGVhZF9yZXNvdXJjZV9jaGFubmVsKGNoYW5uZWxfaWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBkYXRhICs9IGQKICAgICAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShjaGFubmVsLCBNZXRlcnByZXRlclNvY2tldFNlcnZlcik6CiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZWN0LnNlbGVjdChbY2hhbm5lbC5maWxlbm8oKV0sIFtdLCBbXSwgMClbMF06CiAgICAgICAgICAgICAgICAgICAgICAgIChjbGllbnRfc29jaywgY2xpZW50X2FkZHIpID0gY2hhbm5lbC5hY2NlcHQoKQogICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJfYWRkciA9IGNoYW5uZWwuZ2V0c29ja25hbWUoKQogICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRfY2hhbm5lbF9pZCA9IHNlbGYuYWRkX2NoYW5uZWwoTWV0ZXJwcmV0ZXJTb2NrZXRDbGllbnQoY2xpZW50X3NvY2spKQogICAgICAgICAgICAgICAgICAgICAgICBwa3QgID0gc3RydWN0LnBhY2soJz5JJywgUEFDS0VUX1RZUEVfUkVRVUVTVCkKICAgICAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX01FVEhPRCwgJ3RjcF9jaGFubmVsX29wZW4nKQogICAgICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfVVVJRCwgYmluYXNjaWkuYTJiX2hleChieXRlcyhQQVlMT0FEX1VVSUQsICdVVEYtOCcpKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX0NIQU5ORUxfSUQsIGNsaWVudF9jaGFubmVsX2lkKQogICAgICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfQ0hBTk5FTF9QQVJFTlRJRCwgY2hhbm5lbF9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX0xPQ0FMX0hPU1QsIGluZXRfcHRvbihjaGFubmVsLmZhbWlseSwgc2VydmVyX2FkZHJbMF0pKQogICAgICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfTE9DQUxfUE9SVCwgc2VydmVyX2FkZHJbMV0pCiAgICAgICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9QRUVSX0hPU1QsIGluZXRfcHRvbihjbGllbnRfc29jay5mYW1pbHksIGNsaWVudF9hZGRyWzBdKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX1BFRVJfUE9SVCwgY2xpZW50X2FkZHJbMV0pCiAgICAgICAgICAgICAgICAgICAgICAgIHBrdCAgPSBzdHJ1Y3QucGFjaygnPkknLCBsZW4ocGt0KSArIDQpICsgcGt0CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9wYWNrZXQocGt0KQogICAgICAgICAgICAgICAgaWYgZGF0YToKICAgICAgICAgICAgICAgICAgICBwa3QgID0gc3RydWN0LnBhY2soJz5JJywgUEFDS0VUX1RZUEVfUkVRVUVTVCkKICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfTUVUSE9ELCAnY29yZV9jaGFubmVsX3dyaXRlJykKICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfVVVJRCwgYmluYXNjaWkuYTJiX2hleChieXRlcyhQQVlMT0FEX1VVSUQsICdVVEYtOCcpKSkKICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfQ0hBTk5FTF9JRCwgY2hhbm5lbF9pZCkKICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfQ0hBTk5FTF9EQVRBLCBkYXRhKQogICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9MRU5HVEgsIGxlbihkYXRhKSkKICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfUkVRVUVTVF9JRCwgZ2VuZXJhdGVfcmVxdWVzdF9pZCgpKQogICAgICAgICAgICAgICAgICAgIHBrdCAgPSBzdHJ1Y3QucGFjaygnPkknLCBsZW4ocGt0KSArIDQpICsgcGt0CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX3BhY2tldChwa3QpCgogICAgZGVmIGhhbmRsZV9kZWFkX3Jlc291cmNlX2NoYW5uZWwoc2VsZiwgY2hhbm5lbF9pZCk6CiAgICAgICAgZGVsIHNlbGYuY2hhbm5lbHNbY2hhbm5lbF9pZF0KICAgICAgICBpZiBjaGFubmVsX2lkIGluIHNlbGYuaW50ZXJhY3RfY2hhbm5lbHM6CiAgICAgICAgICAgIHNlbGYuaW50ZXJhY3RfY2hhbm5lbHMucmVtb3ZlKGNoYW5uZWxfaWQpCiAgICAgICAgcGt0ICA9IHN0cnVjdC5wYWNrKCc+SScsIFBBQ0tFVF9UWVBFX1JFUVVFU1QpCiAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX01FVEhPRCwgJ2NvcmVfY2hhbm5lbF9jbG9zZScpCiAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX1VVSUQsIGJpbmFzY2lpLmEyYl9oZXgoYnl0ZXMoUEFZTE9BRF9VVUlELCAnVVRGLTgnKSkpCiAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX1JFUVVFU1RfSUQsIGdlbmVyYXRlX3JlcXVlc3RfaWQoKSkKICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfQ0hBTk5FTF9JRCwgY2hhbm5lbF9pZCkKICAgICAgICBwa3QgID0gc3RydWN0LnBhY2soJz5JJywgbGVuKHBrdCkgKyA0KSArIHBrdAogICAgICAgIHNlbGYuc2VuZF9wYWNrZXQocGt0KQoKICAgIGRlZiBfY29yZV9zZXRfdXVpZChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgbmV3X3V1aWQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9VVUlEKQogICAgICAgIGlmIG5ld191dWlkOgogICAgICAgICAgICBQQVlMT0FEX1VVSUQgPSBiaW5hc2NpaS5iMmFfaGV4KG5ld191dWlkWyd2YWx1ZSddKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9lbnVtZXh0Y21kKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBleHRlbnNpb25fbmFtZSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1NUUklORylbJ3ZhbHVlJ10KICAgICAgICBmb3IgZnVuY19uYW1lIGluIHNlbGYuZXh0ZW5zaW9uX2Z1bmN0aW9ucy5rZXlzKCk6CiAgICAgICAgICAgIGlmIGZ1bmNfbmFtZS5zcGxpdCgnXycsIDEpWzBdID09IGV4dGVuc2lvbl9uYW1lOgogICAgICAgICAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfU1RSSU5HLCBmdW5jX25hbWUpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX2dldF9zZXNzaW9uX2d1aWQoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1NFU1NJT05fR1VJRCwgYmluYXNjaWkuYTJiX2hleChieXRlcyhTRVNTSU9OX0dVSUQsICdVVEYtOCcpKSkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfc2V0X3Nlc3Npb25fZ3VpZChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgbmV3X2d1aWQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9TRVNTSU9OX0dVSUQpCiAgICAgICAgaWYgbmV3X2d1aWQ6CiAgICAgICAgICAgIFNFU1NJT05fR1VJRCA9IGJpbmFzY2lpLmIyYV9oZXgobmV3X2d1aWRbJ3ZhbHVlJ10pCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX21hY2hpbmVfaWQoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIHNlcmlhbCA9ICcnCiAgICAgICAgbWFjaGluZV9uYW1lID0gcGxhdGZvcm0udW5hbWUoKVsxXQogICAgICAgIGlmIGhhc193aW5kbGw6CiAgICAgICAgICAgIGZyb20gY3R5cGVzIGltcG9ydCB3aW50eXBlcwoKICAgICAgICAgICAgazMyID0gY3R5cGVzLndpbmRsbC5rZXJuZWwzMgogICAgICAgICAgICBzeXNfZGlyID0gY3R5cGVzLmNyZWF0ZV91bmljb2RlX2J1ZmZlcigyNjApCiAgICAgICAgICAgIGlmIG5vdCBrMzIuR2V0U3lzdGVtRGlyZWN0b3J5VyhjdHlwZXMuYnlyZWYoc3lzX2RpciksIDI2MCk6CiAgICAgICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRV9XSU5ET1dTCgogICAgICAgICAgICB2b2xfYnVmID0gY3R5cGVzLmNyZWF0ZV91bmljb2RlX2J1ZmZlcigyNjApCiAgICAgICAgICAgIGZzX2J1ZiA9IGN0eXBlcy5jcmVhdGVfdW5pY29kZV9idWZmZXIoMjYwKQogICAgICAgICAgICBzZXJpYWxfbnVtID0gd2ludHlwZXMuRFdPUkQoMCkKCiAgICAgICAgICAgIGlmIG5vdCBrMzIuR2V0Vm9sdW1lSW5mb3JtYXRpb25XKGN0eXBlcy5jX3djaGFyX3Aoc3lzX2Rpci52YWx1ZVs6M10pLAogICAgICAgICAgICAgICAgICAgIHZvbF9idWYsIGN0eXBlcy5zaXplb2Yodm9sX2J1ZiksIGN0eXBlcy5ieXJlZihzZXJpYWxfbnVtKSwgTm9uZSwKICAgICAgICAgICAgICAgICAgICBOb25lLCBmc19idWYsIGN0eXBlcy5zaXplb2YoZnNfYnVmKSk6CiAgICAgICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRV9XSU5ET1dTCiAgICAgICAgICAgIHNlcmlhbF9udW0gPSBzZXJpYWxfbnVtLnZhbHVlCiAgICAgICAgICAgIHNlcmlhbCA9ICIlMDR4IiAlICgoc2VyaWFsX251bSA+PiAxNikgJiAweGZmZmYpICsgJy0nICIlMDR4IiAlIChzZXJpYWxfbnVtICYgMHhmZmZmKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlcmlhbCA9IGdldF9oZGRfbGFiZWwoKQoKICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9NQUNISU5FX0lELCAiJXM6JXMiICUgKHNlcmlhbCwgbWFjaGluZV9uYW1lKSkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfbmF0aXZlX2FyY2goc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1NUUklORywgZ2V0X25hdGl2ZV9hcmNoKCkpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX3BhdGNoX3VybChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uoc2VsZi50cmFuc3BvcnQsIEh0dHBUcmFuc3BvcnQpOgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICBuZXdfdXJpX3BhdGggPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19VUkwpWyd2YWx1ZSddCiAgICAgICAgaWYgbm90IHNlbGYudHJhbnNwb3J0LnBhdGNoX3VyaV9wYXRoKG5ld191cmlfcGF0aCk6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9sb2FkbGliKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBkYXRhX3RsdiA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0RBVEEpCiAgICAgICAgaWYgKGRhdGFfdGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX0NPTVBSRVNTRUQpID09IFRMVl9NRVRBX1RZUEVfQ09NUFJFU1NFRDoKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCgogICAgICAgIHNlbGYubGFzdF9yZWdpc3RlcmVkX2V4dGVuc2lvbiA9IE5vbmUKICAgICAgICBzeW1ib2xzX2Zvcl9leHRlbnNpb25zID0geydtZXRlcnByZXRlcic6c2VsZn0KICAgICAgICBzeW1ib2xzX2Zvcl9leHRlbnNpb25zLnVwZGF0ZShFWFBPUlRFRF9TWU1CT0xTKQogICAgICAgIGkgPSBjb2RlLkludGVyYWN0aXZlSW50ZXJwcmV0ZXIoc3ltYm9sc19mb3JfZXh0ZW5zaW9ucykKICAgICAgICBpLnJ1bmNvZGUoY29tcGlsZShkYXRhX3RsdlsndmFsdWUnXSwgJycsICdleGVjJykpCiAgICAgICAgZXh0ZW5zaW9uX25hbWUgPSBzZWxmLmxhc3RfcmVnaXN0ZXJlZF9leHRlbnNpb24KCiAgICAgICAgaWYgZXh0ZW5zaW9uX25hbWU6CiAgICAgICAgICAgIGNoZWNrX2V4dGVuc2lvbiA9IGxhbWJkYSB4OiB4LnN0YXJ0c3dpdGgoZXh0ZW5zaW9uX25hbWUpCiAgICAgICAgICAgIGxpYl9tZXRob2RzID0gbGlzdChmaWx0ZXIoY2hlY2tfZXh0ZW5zaW9uLCBsaXN0KHNlbGYuZXh0ZW5zaW9uX2Z1bmN0aW9ucy5rZXlzKCkpKSkKICAgICAgICAgICAgZm9yIG1ldGhvZCBpbiBsaWJfbWV0aG9kczoKICAgICAgICAgICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX01FVEhPRCwgbWV0aG9kKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9zaHV0ZG93bihzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfQk9PTCwgVHJ1ZSkKICAgICAgICBzZWxmLnJ1bm5pbmcgPSBGYWxzZQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV90cmFuc3BvcnRfYWRkKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBuZXdfdHJhbnNwb3J0ID0gVHJhbnNwb3J0LmZyb21fcmVxdWVzdChyZXF1ZXN0KQogICAgICAgIHNlbGYudHJhbnNwb3J0X2FkZChuZXdfdHJhbnNwb3J0KQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV90cmFuc3BvcnRfY2hhbmdlKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBuZXdfdHJhbnNwb3J0ID0gVHJhbnNwb3J0LmZyb21fcmVxdWVzdChyZXF1ZXN0KQogICAgICAgIHNlbGYudHJhbnNwb3J0X2FkZChuZXdfdHJhbnNwb3J0KQogICAgICAgIHNlbGYuc2VuZF9wYWNrZXQodGx2X3BhY2tfcmVzcG9uc2UoRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UpKQogICAgICAgIHNlbGYudHJhbnNwb3J0X2NoYW5nZShuZXdfdHJhbnNwb3J0KQogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIF9jb3JlX3RyYW5zcG9ydF9saXN0KHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBpZiBzZWxmLnNlc3Npb25fZXhwaXJ5X3RpbWUgPiAwOgogICAgICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9UUkFOU19TRVNTSU9OX0VYUCwgc2VsZi5zZXNzaW9uX2V4cGlyeV9lbmQgLSB0aW1lLnRpbWUoKSkKICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9UUkFOU19HUk9VUCwgc2VsZi50cmFuc3BvcnQudGx2X3BhY2tfdHJhbnNwb3J0X2dyb3VwKCkpCgogICAgICAgIHRyYW5zcG9ydCA9IHNlbGYudHJhbnNwb3J0X25leHQoKQogICAgICAgIHdoaWxlIHRyYW5zcG9ydCAhPSBzZWxmLnRyYW5zcG9ydDoKICAgICAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfVFJBTlNfR1JPVVAsIHRyYW5zcG9ydC50bHZfcGFja190cmFuc3BvcnRfZ3JvdXAoKSkKICAgICAgICAgICAgdHJhbnNwb3J0ID0gc2VsZi50cmFuc3BvcnRfbmV4dCh0cmFuc3BvcnQpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX3RyYW5zcG9ydF9uZXh0KHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBuZXdfdHJhbnNwb3J0ID0gc2VsZi50cmFuc3BvcnRfbmV4dCgpCiAgICAgICAgaWYgbmV3X3RyYW5zcG9ydCA9PSBzZWxmLnRyYW5zcG9ydDoKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgc2VsZi5zZW5kX3BhY2tldCh0bHZfcGFja19yZXNwb25zZShFUlJPUl9TVUNDRVNTLCByZXNwb25zZSkpCiAgICAgICAgc2VsZi50cmFuc3BvcnRfY2hhbmdlKG5ld190cmFuc3BvcnQpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgX2NvcmVfdHJhbnNwb3J0X3ByZXYoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIG5ld190cmFuc3BvcnQgPSBzZWxmLnRyYW5zcG9ydF9wcmV2KCkKICAgICAgICBpZiBuZXdfdHJhbnNwb3J0ID09IHNlbGYudHJhbnNwb3J0OgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICBzZWxmLnNlbmRfcGFja2V0KHRsdl9wYWNrX3Jlc3BvbnNlKEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlKSkKICAgICAgICBzZWxmLnRyYW5zcG9ydF9jaGFuZ2UobmV3X3RyYW5zcG9ydCkKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBfY29yZV90cmFuc3BvcnRfcmVtb3ZlKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICB1cmwgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19VUkwpWyd2YWx1ZSddCiAgICAgICAgaWYgc2VsZi50cmFuc3BvcnQudXJsID09IHVybDoKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgdHJhbnNwb3J0X2ZvdW5kID0gRmFsc2UKICAgICAgICBmb3IgdHJhbnNwb3J0IGluIHNlbGYudHJhbnNwb3J0czoKICAgICAgICAgICAgaWYgdHJhbnNwb3J0LnVybCA9PSB1cmw6CiAgICAgICAgICAgICAgICB0cmFuc3BvcnRfZm91bmQgPSBUcnVlCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGlmIHRyYW5zcG9ydF9mb3VuZDoKICAgICAgICAgICAgc2VsZi50cmFuc3BvcnRzLnJlbW92ZSh0cmFuc3BvcnQpCiAgICAgICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQogICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV90cmFuc3BvcnRfc2V0X3RpbWVvdXRzKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICB0aW1lb3V0X3ZhbHVlID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfU0VTU0lPTl9FWFApLmdldCgndmFsdWUnKQogICAgICAgIGlmIG5vdCB0aW1lb3V0X3ZhbHVlIGlzIE5vbmU6CiAgICAgICAgICAgIHNlbGYuc2Vzc2lvbl9leHBpcnlfdGltZSA9IHRpbWVvdXRfdmFsdWUKICAgICAgICAgICAgc2VsZi5zZXNzaW9uX2V4cGlyeV9lbmQgPSB0aW1lLnRpbWUoKSArIHNlbGYuc2Vzc2lvbl9leHBpcnlfdGltZQogICAgICAgIHRpbWVvdXRfdmFsdWUgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19DT01NX1RJTUVPVVQpLmdldCgndmFsdWUnKQogICAgICAgIGlmIHRpbWVvdXRfdmFsdWU6CiAgICAgICAgICAgIHNlbGYudHJhbnNwb3J0LmNvbW11bmljYXRpb25fdGltZW91dCA9IHRpbWVvdXRfdmFsdWUKICAgICAgICByZXRyeV92YWx1ZSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX1JFVFJZX1RPVEFMKS5nZXQoJ3ZhbHVlJykKICAgICAgICBpZiByZXRyeV92YWx1ZToKICAgICAgICAgICAgc2VsZi50cmFuc3BvcnQucmV0cnlfdG90YWwgPSByZXRyeV92YWx1ZQogICAgICAgIHJldHJ5X3ZhbHVlID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfUkVUUllfV0FJVCkuZ2V0KCd2YWx1ZScpCiAgICAgICAgaWYgcmV0cnlfdmFsdWU6CiAgICAgICAgICAgIHNlbGYudHJhbnNwb3J0LnJldHJ5X3dhaXQgPSByZXRyeV92YWx1ZQoKICAgICAgICBpZiBzZWxmLnNlc3Npb25fZXhwaXJ5X3RpbWUgPiAwOgogICAgICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9UUkFOU19TRVNTSU9OX0VYUCwgc2VsZi5zZXNzaW9uX2V4cGlyeV9lbmQgLSB0aW1lLnRpbWUoKSkKICAgICAgICByZXNwb25zZSArPSBzZWxmLnRyYW5zcG9ydC50bHZfcGFja190aW1lb3V0cygpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX3RyYW5zcG9ydF9zbGVlcChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgc2Vjb25kcyA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX0NPTU1fVElNRU9VVClbJ3ZhbHVlJ10KICAgICAgICBzZWxmLnNlbmRfcGFja2V0KHRsdl9wYWNrX3Jlc3BvbnNlKEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlKSkKICAgICAgICBpZiBzZWNvbmRzOgogICAgICAgICAgICBzZWxmLl90cmFuc3BvcnRfc2xlZXAgPSBzZWNvbmRzCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX2NoYW5uZWxfb3BlbihzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgY2hhbm5lbF90eXBlID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfQ0hBTk5FTF9UWVBFKQogICAgICAgIGhhbmRsZXIgPSAnY2hhbm5lbF9vcGVuXycgKyBjaGFubmVsX3R5cGVbJ3ZhbHVlJ10KICAgICAgICBpZiBoYW5kbGVyIG5vdCBpbiBzZWxmLmV4dGVuc2lvbl9mdW5jdGlvbnM6CiAgICAgICAgICAgIHJldHVybiBlcnJvcl9yZXN1bHQoTm90SW1wbGVtZW50ZWRFcnJvciksIHJlc3BvbnNlCiAgICAgICAgaGFuZGxlciA9IHNlbGYuZXh0ZW5zaW9uX2Z1bmN0aW9uc1toYW5kbGVyXQogICAgICAgIHJldHVybiBoYW5kbGVyKHJlcXVlc3QsIHJlc3BvbnNlKQoKICAgIGRlZiBfY29yZV9jaGFubmVsX2Nsb3NlKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBjaGFubmVsX2lkID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfQ0hBTk5FTF9JRClbJ3ZhbHVlJ10KICAgICAgICBpZiBjaGFubmVsX2lkIG5vdCBpbiBzZWxmLmNoYW5uZWxzOgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICBjaGFubmVsID0gc2VsZi5jaGFubmVsc1tjaGFubmVsX2lkXQogICAgICAgIGlmIGlzaW5zdGFuY2UoY2hhbm5lbCwgc3VicHJvY2Vzcy5Qb3Blbik6CiAgICAgICAgICAgIGNoYW5uZWwua2lsbCgpCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKGNoYW5uZWwsIE1ldGVycHJldGVyRmlsZSk6CiAgICAgICAgICAgIGNoYW5uZWwuY2xvc2UoKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShjaGFubmVsLCBNZXRlcnByZXRlclNvY2tldCk6CiAgICAgICAgICAgIGNoYW5uZWwuY2xvc2UoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIGRlbCBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgaWYgY2hhbm5lbF9pZCBpbiBzZWxmLmludGVyYWN0X2NoYW5uZWxzOgogICAgICAgICAgICBzZWxmLmludGVyYWN0X2NoYW5uZWxzLnJlbW92ZShjaGFubmVsX2lkKQogICAgICAgIGRlYnVnX3ByaW50KCdbKl0gY2xvc2VkIGFuZCByZW1vdmVkIGNoYW5uZWwgaWQ6ICcgKyBzdHIoY2hhbm5lbF9pZCkpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX2NoYW5uZWxfZW9mKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBjaGFubmVsX2lkID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfQ0hBTk5FTF9JRClbJ3ZhbHVlJ10KICAgICAgICBpZiBjaGFubmVsX2lkIG5vdCBpbiBzZWxmLmNoYW5uZWxzOgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICBjaGFubmVsID0gc2VsZi5jaGFubmVsc1tjaGFubmVsX2lkXQogICAgICAgIHJlc3VsdCA9IEZhbHNlCiAgICAgICAgaWYgaXNpbnN0YW5jZShjaGFubmVsLCBNZXRlcnByZXRlckZpbGUpOgogICAgICAgICAgICByZXN1bHQgPSBjaGFubmVsLnRlbGwoKSA+PSBvcy5mc3RhdChjaGFubmVsLmZpbGVubygpKS5zdF9zaXplCiAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfQk9PTCwgcmVzdWx0KQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9jaGFubmVsX2ludGVyYWN0KHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBjaGFubmVsX2lkID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfQ0hBTk5FTF9JRClbJ3ZhbHVlJ10KICAgICAgICBpZiBjaGFubmVsX2lkIG5vdCBpbiBzZWxmLmNoYW5uZWxzOgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICBjaGFubmVsID0gc2VsZi5jaGFubmVsc1tjaGFubmVsX2lkXQogICAgICAgIHRvZ2dsZSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0JPT0wpWyd2YWx1ZSddCiAgICAgICAgaWYgdG9nZ2xlOgogICAgICAgICAgICBpZiBjaGFubmVsX2lkIGluIHNlbGYuaW50ZXJhY3RfY2hhbm5lbHM6CiAgICAgICAgICAgICAgICBzZWxmLmludGVyYWN0X2NoYW5uZWxzLnJlbW92ZShjaGFubmVsX2lkKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5pbnRlcmFjdF9jaGFubmVscy5hcHBlbmQoY2hhbm5lbF9pZCkKICAgICAgICBlbGlmIGNoYW5uZWxfaWQgaW4gc2VsZi5pbnRlcmFjdF9jaGFubmVsczoKICAgICAgICAgICAgc2VsZi5pbnRlcmFjdF9jaGFubmVscy5yZW1vdmUoY2hhbm5lbF9pZCkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfY2hhbm5lbF9yZWFkKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBjaGFubmVsX2lkID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfQ0hBTk5FTF9JRClbJ3ZhbHVlJ10KICAgICAgICBsZW5ndGggPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9MRU5HVEgpWyd2YWx1ZSddCiAgICAgICAgaWYgY2hhbm5lbF9pZCBub3QgaW4gc2VsZi5jaGFubmVsczoKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgY2hhbm5lbCA9IHNlbGYuY2hhbm5lbHNbY2hhbm5lbF9pZF0KICAgICAgICBkYXRhID0gJycKICAgICAgICBpZiBpc2luc3RhbmNlKGNoYW5uZWwsIFNURFByb2Nlc3MpOgogICAgICAgICAgICBpZiBjaGFubmVsLnBvbGwoKSAhPSBOb25lOgogICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVfZGVhZF9yZXNvdXJjZV9jaGFubmVsKGNoYW5uZWxfaWQpCiAgICAgICAgICAgIGlmIGNoYW5uZWwuc3Rkb3V0X3JlYWRlci5pc19yZWFkX3JlYWR5KCk6CiAgICAgICAgICAgICAgICBkYXRhID0gY2hhbm5lbC5zdGRvdXRfcmVhZGVyLnJlYWQobGVuZ3RoKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShjaGFubmVsLCBNZXRlcnByZXRlckZpbGUpOgogICAgICAgICAgICBkYXRhID0gY2hhbm5lbC5yZWFkKGxlbmd0aCkKICAgICAgICBlbGlmIGlzaW5zdGFuY2UoY2hhbm5lbCwgTWV0ZXJwcmV0ZXJTb2NrZXQpOgogICAgICAgICAgICBkYXRhID0gY2hhbm5lbC5yZWN2KGxlbmd0aCkKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9DSEFOTkVMX0RBVEEsIGRhdGEpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX2NoYW5uZWxfd3JpdGUoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGNoYW5uZWxfaWQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9DSEFOTkVMX0lEKVsndmFsdWUnXQogICAgICAgIGNoYW5uZWxfZGF0YSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0NIQU5ORUxfREFUQSlbJ3ZhbHVlJ10KICAgICAgICBsZW5ndGggPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9MRU5HVEgpWyd2YWx1ZSddCiAgICAgICAgaWYgY2hhbm5lbF9pZCBub3QgaW4gc2VsZi5jaGFubmVsczoKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgY2hhbm5lbCA9IHNlbGYuY2hhbm5lbHNbY2hhbm5lbF9pZF0KICAgICAgICBsID0gbGVuKGNoYW5uZWxfZGF0YSkKICAgICAgICBpZiBpc2luc3RhbmNlKGNoYW5uZWwsIHN1YnByb2Nlc3MuUG9wZW4pOgogICAgICAgICAgICBpZiBjaGFubmVsLnBvbGwoKSAhPSBOb25lOgogICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVfZGVhZF9yZXNvdXJjZV9jaGFubmVsKGNoYW5uZWxfaWQpCiAgICAgICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICAgICAgY2hhbm5lbC53cml0ZShjaGFubmVsX2RhdGEpCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKGNoYW5uZWwsIE1ldGVycHJldGVyRmlsZSk6CiAgICAgICAgICAgIGNoYW5uZWwud3JpdGUoY2hhbm5lbF9kYXRhKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShjaGFubmVsLCBNZXRlcnByZXRlclNvY2tldCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGwgPSBjaGFubmVsLnNlbmQoY2hhbm5lbF9kYXRhKQogICAgICAgICAgICBleGNlcHQgc29ja2V0LmVycm9yOgogICAgICAgICAgICAgICAgY2hhbm5lbC5jbG9zZSgpCiAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZV9kZWFkX3Jlc291cmNlX2NoYW5uZWwoY2hhbm5lbF9pZCkKICAgICAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX0xFTkdUSCwgbCkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgY3JlYXRlX3Jlc3BvbnNlKHNlbGYsIHJlcXVlc3QpOgogICAgICAgIHJlc3AgPSBzdHJ1Y3QucGFjaygnPkknLCBQQUNLRVRfVFlQRV9SRVNQT05TRSkKICAgICAgICBtZXRob2RfdGx2ID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfTUVUSE9EKQogICAgICAgIHJlc3AgKz0gdGx2X3BhY2sobWV0aG9kX3RsdikKICAgICAgICByZXNwICs9IHRsdl9wYWNrKFRMVl9UWVBFX1VVSUQsIGJpbmFzY2lpLmEyYl9oZXgoYnl0ZXMoUEFZTE9BRF9VVUlELCAnVVRGLTgnKSkpCgogICAgICAgIGhhbmRsZXJfbmFtZSA9IG1ldGhvZF90bHZbJ3ZhbHVlJ10KICAgICAgICBpZiBoYW5kbGVyX25hbWUgaW4gc2VsZi5leHRlbnNpb25fZnVuY3Rpb25zOgogICAgICAgICAgICBoYW5kbGVyID0gc2VsZi5leHRlbnNpb25fZnVuY3Rpb25zW2hhbmRsZXJfbmFtZV0KICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGVidWdfcHJpbnQoJ1sqXSBydW5uaW5nIG1ldGhvZCAnICsgaGFuZGxlcl9uYW1lKQogICAgICAgICAgICAgICAgcmVzdWx0ID0gaGFuZGxlcihyZXF1ZXN0LCByZXNwKQogICAgICAgICAgICAgICAgaWYgcmVzdWx0IGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICByZXN1bHQsIHJlc3AgPSByZXN1bHQKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGRlYnVnX3RyYWNlYmFjaygnWy1dIG1ldGhvZCAnICsgaGFuZGxlcl9uYW1lICsgJyByZXN1bHRlZCBpbiBhbiBlcnJvcicpCiAgICAgICAgICAgICAgICByZXN1bHQgPSBlcnJvcl9yZXN1bHQoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgcmVzdWx0ICE9IEVSUk9SX1NVQ0NFU1M6CiAgICAgICAgICAgICAgICAgICAgZGVidWdfcHJpbnQoJ1stXSBtZXRob2QgJyArIGhhbmRsZXJfbmFtZSArICcgcmVzdWx0ZWQgaW4gZXJyb3I6ICMnICsgc3RyKHJlc3VsdCkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGVidWdfcHJpbnQoJ1stXSBtZXRob2QgJyArIGhhbmRsZXJfbmFtZSArICcgd2FzIHJlcXVlc3RlZCBidXQgZG9lcyBub3QgZXhpc3QnKQogICAgICAgICAgICByZXN1bHQgPSBlcnJvcl9yZXN1bHQoTm90SW1wbGVtZW50ZWRFcnJvcikKCiAgICAgICAgcmVxaWRfdGx2ID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfUkVRVUVTVF9JRCkKICAgICAgICBpZiBub3QgcmVxaWRfdGx2OgogICAgICAgICAgICByZXR1cm4KICAgICAgICByZXNwICs9IHRsdl9wYWNrKHJlcWlkX3RsdikKICAgICAgICByZXR1cm4gdGx2X3BhY2tfcmVzcG9uc2UocmVzdWx0LCByZXNwKQoKX3RyeV90b19mb3JrID0gVFJZX1RPX0ZPUksgYW5kIGhhc2F0dHIob3MsICdmb3JrJykKaWYgbm90IF90cnlfdG9fZm9yayBvciAoX3RyeV90b19mb3JrIGFuZCBvcy5mb3JrKCkgPT0gMCk6CiAgICBpZiBoYXNhdHRyKG9zLCAnc2V0c2lkJyk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBvcy5zZXRzaWQoKQogICAgICAgIGV4Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICBwYXNzCiAgICBpZiBIVFRQX0NPTk5FQ1RJT05fVVJMIGFuZCBoYXNfdXJsbGliOgogICAgICAgIHRyYW5zcG9ydCA9IEh0dHBUcmFuc3BvcnQoSFRUUF9DT05ORUNUSU9OX1VSTCwgcHJveHk9SFRUUF9QUk9YWSwgdXNlcl9hZ2VudD1IVFRQX1VTRVJfQUdFTlQsCiAgICAgICAgICAgICAgICBodHRwX2hvc3Q9SFRUUF9IT1NULCBodHRwX3JlZmVyZXI9SFRUUF9SRUZFUkVSLCBodHRwX2Nvb2tpZT1IVFRQX0NPT0tJRSkKICAgIGVsc2U6CiAgICAgICAgYmluZF9zb2NrID0gc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCwgc29ja2V0LlNPQ0tfU1RSRUFNKQogICAgICAgIGJpbmRfc29jay5iaW5kKCgnMC4wLjAuMCcsIDQ0NDQpKQogICAgICAgIGJpbmRfc29jay5saXN0ZW4oMSkKICAgICAgICBzLCBhZGRyZXNzID0gYmluZF9zb2NrLmFjY2VwdCgpCgogICAgICAgIHRyYW5zcG9ydCA9IFRjcFRyYW5zcG9ydC5mcm9tX3NvY2tldChzKQogICAgbWV0ID0gUHl0aG9uTWV0ZXJwcmV0ZXIodHJhbnNwb3J0KQogICAgIyBQQVRDSC1TRVRVUC1UUkFOU1BPUlRTICMKICAgIG1ldC5ydW4oKQo=')))